var Main=pc.createScript("main");Main.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"Obst Mats"}),Main.attributes.add("matTaces",{type:"asset",assetType:"material",array:!0,title:"Trace Mats"}),Main.attributes.add("matStars",{type:"asset",assetType:"material",array:!0,title:"Star Mats"}),Main.attributes.add("hvostWhite",{type:"asset",assetType:"material",title:"Tail white"}),Main.attributes.add("bgMain",{type:"entity",title:"Bg Main"}),Main.attributes.add("bgBonus",{type:"entity",title:"Bg Bonus"}),Main.attributes.add("ball",{type:"entity",title:"Ball Entity"}),Main.attributes.add("tail",{type:"entity",title:"tail Entity"}),Main.attributes.add("circPapa",{type:"entity",title:"circ10"}),Main.attributes.add("starPapa",{type:"entity",title:"starObst"}),Main.attributes.add("bitPapa",{type:"entity",title:"bit part"}),Main.attributes.add("bitStarPapa",{type:"entity",title:"star part"}),Main.attributes.add("sparkPapa",{type:"entity",title:"trace"}),Main.attributes.add("glowFlash",{type:"entity",title:"glow"}),Main.attributes.add("starZZ",{type:"entity",title:"star Zig"}),Main.attributes.add("glowZZ",{type:"entity",title:"glow Zig"}),Main.attributes.add("gameSpeed",{type:"number",default:1,title:"Game speed coef"}),Main.attributes.add("colorsNum",{type:"number",default:4,title:"Colors Num"}),Main.attributes.add("TransformZ",{type:"number",default:-40,title:"TransZ"}),Main.attributes.add("Y_mess",{type:"number",default:265,title:"Y message"}),Main.attributes.add("scoreText",{type:"entity",title:"scoreText"}),Main.attributes.add("textMess",{type:"entity",title:"textMess"}),Main.attributes.add("glowMess",{type:"entity",title:"glowMess"}),Main.attributes.add("scoreScreen",{type:"entity",title:"scoreScreen"}),Main.attributes.add("obstBornZ",{type:"number",default:-100,title:"Obst Born Z"}),Main.attributes.add("obstSpeed",{type:"number",default:21,title:"Obst Speed"}),Main.attributes.add("obstDist",{type:"number",default:25,title:"Obst Distance"}),Main.attributes.add("obstRad",{type:"number",default:1.5,title:"Obst Rad"}),Main.attributes.add("starRad",{type:"number",default:1.37,title:"Star Rad"}),Main.attributes.add("obstRotSpeed",{type:"number",default:90,title:"Obst Rot Speed"}),Main.attributes.add("zzDistStart",{type:"number",default:40,title:"Zig DistStart"}),Main.attributes.add("zzDist",{type:"number",default:100,title:"Zig Dist"}),Main.attributes.add("zzDistEnd",{type:"number",default:40,title:"Zig DistEnd"}),Main.attributes.add("zzDistStep",{type:"number",default:10,title:"Zig DistStep"}),Main.attributes.add("zzAngStep",{type:"number",default:60,title:"Zig AngStep"}),Main.attributes.add("zigRad",{type:"number",default:1.5,title:"Zig Rad"}),Main.attributes.add("ZigStarsMin",{type:"number",default:2,title:"Zig Stars Min"}),Main.attributes.add("BonusSpeedUp",{type:"number",default:1.5,title:"Zig Speed Up"}),Main.attributes.add("BonusSpeedTimeUp",{type:"number",default:2,title:"Zig Speed Time Up"}),Main.attributes.add("BonusSpeedTimeDown",{type:"number",default:2,title:"Zig Speed Time down"}),Main.attributes.add("traceRate",{type:"number",default:.25,title:"Trace Rate"}),Main.attributes.add("traceSpeed",{type:"number",default:70,title:"Trace Speed"}),Main.attributes.add("traceZ",{type:"number",default:-90,title:"Trace Born"}),Main.attributes.add("traceRad",{type:"number",default:3,title:"Trace Rad"}),Main.GAMESPEED=1,GAME_INTRO=0,GAME_PLAYING=1,GAME_GAMEOVER=2,Main.instance=null,Main.prototype.initialize=function(){Main.instance=this,this.scoreToZigZag=0,this.ZZags=[],this.obstDistCntr=0,this.materialIndex=0,this._vec3=new pc.Vec3,this.AngleCircSpan=10,this.AngleStarSpan=7,this.CloneCntr=0,this.Chunks=[],this.Traces=[],this.BallParts=[],this.BitParts=[],this.Rings=[],this.Pops=[],this.Shades=[],this.Glows=[],this.ZZag=null,this.updateSpeeds(),this.app.addTweenManager(),this.Score=0,this.Colors=[(new pc.Color).fromString("#f235da"),(new pc.Color).fromString("#dbc33a"),(new pc.Color).fromString("#24d5f5"),(new pc.Color).fromString("#de3f25")],this.BitColors=[(new pc.Color).fromString("#f235da"),(new pc.Color).fromString("#dbc33a"),(new pc.Color).fromString("#24d5f5"),(new pc.Color).fromString("#ff2638")],this.TextColors=[(new pc.Color).fromString("#f235da"),(new pc.Color).fromString("#ffdc14"),(new pc.Color).fromString("#24d5f5"),(new pc.Color).fromString("#ff5664")],this.StarColors=[(new pc.Color).fromString("#FFFFFF"),(new pc.Color).fromString("#ffdc14"),(new pc.Color).fromString("#24d5f5"),(new pc.Color).fromString("#ff2638")],this.ColorShade=(new pc.Color).fromString("#000000"),this.ColorWhite=(new pc.Color).fromString("#FFFFFF"),this.ColorYellow=(new pc.Color).fromString("#FFFF00"),this.ColorTextYellow=(new pc.Color).fromString("#dbdbdb"),this.ColorGrey=(new pc.Color).fromString("#7D7D7D"),this.Texts=["GREAT!","NICE!","PERFECT!","AWESOME!","GOOD JOB!","SUPER!"],this.TextsIndex=Math.floor(Math.random()*this.Texts.length),this.LevelsNum=5,this.AllowGameInputFlag=!1,this.ObstSave=[],this.StarSave=[],this.ObstIDCntr=0,this.app.on("ball:collide",(function(t,e,i){this.setGameLoose(t,e,i)}),this),this.app.on("spash:in",(function(){this.setIntro(),this.AllowGameInputFlag=!1,this.app.root.findByName("Splash").script.splash.setFadeOut(0,null)}),this),this.app.on("spash:out",(function(){this.AllowGameInputFlag=!0}),this),this.app.on("game:circlepassed",this.onObstaclePass,this),this.app.on("ball:star",this.onStarZigCollide,this),this.app.on("ball:color",this.onBallColor,this),this.app.on("game:stopzig",this.onEndZigZag,this);var t=this.app.mouse;t&&(t.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),t.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this));var e=this.app.touch;e&&(e.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),e.on(pc.EVENT_TOUCHSTART,this.onTouchDown,this)),this.oldCurrColor=-1,this.oldColor=-1,this.TraceAngle=Math.PI*Math.random(),this.TraceRate=this.traceRate,this.TraceRateCntr=0,this.textMess.enabled=!1,this.glowMess.enabled=!1},Main.prototype.postInitialize=function(){this.setIntro()},Main.prototype.setRandomColor=function(){this.currColor=Math.floor(this.colorsNum*Math.random()),this.currColor===this.oldCurrColor&&(this.currColor=this.oldCurrColor+1),this.currColor>=this.colorsNum&&(this.currColor=0),this.oldCurrColor=this.currColor,this.setCurrColor(this.currColor)},Main.prototype.setCurrColor=function(t){this.currColor=t,this.ball.script.ball.setColor(this.currColor),this.tail.script.hvost.setColor(this.currColor)},Main.prototype.setBallWhite=function(){this.ball.script.ball.setMaterial(this.matStars[0]),this.tail.script.hvost.setMaterial(this.hvostWhite)},Main.prototype.showGameMessage=function(t,e,i,s,a,r,n,o){if(this.textMess.enabled=!0,this.textMess.script.popText.Create2(t,e,i,a,s,1,n),o&&this.textMess.script.popText.setShadow(0,-.5,this.ColorShade),r){this.glowMess.enabled=!0;var l=.5+2.2*e.length/10;this.glowMess.script.popShade.Create2(t,i,a,3*s,l,.3,n)}},Main.prototype.makeScorePop=function(t,e,i,s,a,r,n){(o=this.getPop()).script.popText.Create(t,e-.01,i-.02,s,this.ColorShade,n,r,.2,.7);var o=this.getPop();o.script.popText.Create(t,e,i,s,a,n,r,1,.7)},Main.prototype.addScore=function(t){this.Score+=t,this.Score===t||this.app.fire("score:change",this.Score),this.app.fire("game:addscore",t),js_GS_sendScore(this.Score)},Main.prototype.setIntro=function(){this.scoreToZigZag=pc.math.random(50,100),this.LevelsIndex=0,this.LevelsIndexPrev=-1,this.LevelDef=null,this.ball.enabled=!0,this.ball.script.ball.Revive(),this.tail.enabled=!0,this.tail.script.hvost.Revive(),this.tail.script.hvost.setVisible(!1),this.clearObstacles();var t=this.app.root.findByName("spriteSlide");t.enabled=!0,t.script.slider.Revive(),this.AllowGameInputFlag=!0,this.gameState=GAME_INTRO,Game.instance.tutorSlider.enabled=!0,this.makeRings(2);var e=this.getNearestRing();null!==e&&this.setCurrColor(e.script.ring.Color),Game.instance.onGoIntro(),this.app.fire("game:startintro")},Main.prototype.DoPlay=function(){this.ball.script.ball.setPlayState(),this.tail.script.hvost.setVisible(!0),this.obstDistCntr=this.obstDist,this.materialIndex=Math.floor(this.materials.length*Math.random()),this.matCntr=0,this.Score=0,this.StarCntr=0,this.gameState=GAME_PLAYING,Game.instance.tutorSlider.enabled=!1,completedLevels=0,this.gameSpeed=1,this.updateSpeeds(),this.runRings(),this.LevelsIndexPrev=-1,this.SpeedCoeff=1,this.SpeedCoeffFlag=!1,this.ZigZagFlag=!1,this.app.fire("game:startgame")},Main.prototype.setSpeedCoeffDest=function(t,e){var i={coeff:this.SpeedCoeff},s=this;this.tweenCoeff=this.entity.tween(i).to({coeff:t},e,pc.CubicInOut),this.tweenCoeff.on("update",(function(t){s.SpeedCoeff=i.coeff,s.updateSpeeds(s.SpeedCoeff)})),this.tweenCoeff.start()},Main.prototype.gameOver=function(t,e){js_GS_gameOver(),Game.instance.onGameOver(t,this.Score),this.app.fire("game:stop"),this.app.fire("game:gameover",t,e),this.gameState=GAME_GAMEOVER},Main.prototype.onObstaclePass=function(){this.ball.script.ball.setStars(!1),this.showGameMessage(this.Y_mess,"MISSED!",this.ColorGrey,2,0,!1,.75,!0)},Main.prototype.onStarZigCollide=function(t,e){this.ball.script.ball.getPosRad(this.ball.script.ball.RotAngle,.5,this._vec3),this.makeScorePop(this._vec3.x+0*pc.math.random(-.1,.1),this._vec3.y+pc.math.random(-.6,.6),this._vec3.z+2,"+10",this.ColorWhite,.6,pc.math.random(-10,10)),this.ball.script.ball.getPosRad(this.ball.script.ball.RotAngle,1,this._vec3),this.makeWhiteColorExplode(this._vec3.x,this._vec3.y,this._vec3.z),this.addScore(10),Game.instance.stars++,GameAudio.play("star")},Main.prototype.onEndZigZag=function(t){var e=this.getNearestRing(),i=0;null!==e&&(i=e.script.ring.Color),console.log("onlyOne:"+t.toString()),t||(this.setCurrColor(i),this.ball.script.ball.setStars(!1)),this.bgBonus.script.bgFader.FadeOut(.75),this.setSpeedCoeffDest(1,this.BonusSpeedTimeDown),this.ZigZagFlag=!1;var s=this.getGlow();this.ball.script.ball.getPosRad(this.ball.script.ball.RotAngle,1,this._vec3),t||s.script.glowCirc.Create(this._vec3.x,this._vec3.y,this._vec3.z,1.2,this.ColorWhite,.6,.7)},Main.prototype.makeSmallZigZag=function(t){this.ZZag=new pc.Entity,this.ZZags.push(this.ZZag),this.ZZag.addComponent("script"),this.ZZag.script.create("starsZig",{attributes:{type:0}}),this.ZZag.script.starsZig.setParams(this.matStars,this.StarColors),this.app.root.addChild(this.ZZag),this.ZZag.script.starsZig.Create(t,this.zigRad,.1,this.zzDistStep,this.zzAngStep,this.starZZ,this.glowZZ,1,this.ball,0),this.ZZag=null},Main.prototype.onBallColor=function(t,e,i,s,a){if(i){Game.instance.stars++,this.StarCntr++;var r=MathUtil.rr(-5,5);this.showGameMessage(this.Y_mess,this.Texts[this.TextsIndex],this.ColorYellow,1.8,r,!0,1.5,!1);var n=this.TextsIndex;this.TextsIndex=Math.floor(this.Texts.length*Math.random()),this.TextsIndex===n&&this.TextsIndex++,this.TextsIndex>=this.Texts.length&&(this.TextsIndex=0),GameAudio.playEx("streak",1+(this.StarCntr-1)/14)}else GameAudio.play("break");this.ball.script.ball.getPos(this.ball.script.ball.RotAngle,this._vec3),i?(this.makeStarColorExplode(this._vec3.x,this._vec3.y,this._vec3.z,s),this.StarCntr>2&&this.ball.script.ball.setStars(!0)):(this.makeBlockColorExplode(e.Color,t,this._vec3.z),this.StarCntr=0,this.ball.script.ball.setStars(!1));var o,l=this.getNearestRing(),h=0;null!==l&&(h=l.script.ring.Color,this.setCurrColor(h));var p=1;i&&(p=10);var c=this.StarCntr>0&&this.StarCntr%this.ZigStarsMin==0&&!1===this.ZigZagFlag;if(this.ball.script.ball.getPosRad(this.ball.script.ball.RotAngle,.5,this._vec3),c||this.makeScorePop(this._vec3.x,this._vec3.y,this._vec3.z+2,"+"+p,this.TextColors[h],.8,0),this.addScore(p),this.scoreToZigZag-=p,c){for(var d=0;d<this.ZZags.length;d++)this.ZZags[d]&&this.ZZags[d].destroy();this.ZZags=[],GameAudio.play("starBonus"),this.showGameMessage(200,"PERFECT STREAK!",this.ColorWhite,2,pc.math.random(-5,5),!0,2.5,!1),this.makeRingExplode(a,2,2),a.Off();for(d=0;d<this.Rings.length;d++)this.Rings[d].enabled&&(this.makeRingExplode(this.Rings[d].script.ring,1,2),this.Rings[d].script.ring.Off());this.bgBonus.enabled=!0,this.bgBonus.script.bgFader.Create(.75),this.setBallWhite(),this.makeZigZag();var g=Math.abs(this.ball.script.ball.Z)+this.zzDistStart+this.zzDist+this.zzDistEnd;g<Math.abs(this.obstBornZ)?this.obstDistCntr=Math.abs(this.obstBornZ)-g:this.obstDistCntr=g-Math.abs(this.obstBornZ),this.ball.script.ball.setStars(!0),this.ball.script.ball.setStarsColor(this.ColorWhite),this.setSpeedCoeffDest(this.BonusSpeedUp,this.BonusSpeedTimeUp),o=this.getGlow(),this.ball.script.ball.getPosRad(this.ball.script.ball.RotAngle,1,this._vec3),o.script.glowCirc.Create(this._vec3.x,this._vec3.y,this._vec3.z,1.2,this.ColorWhite,.6,.7),this.ZigZagFlag=!0}else o=this.getGlow(),this.ball.script.ball.getPos(this.ball.script.ball.RotAngle,this._vec3),o.script.glowCirc.Create(this._vec3.x,this._vec3.y,this._vec3.z,1,this.Colors[h],.5,.7)},Main.prototype.setGameLoose=function(t,e,i){if(this.gameState!==GAME_GAMEOVER){var s=this.ball.getPosition().x,a=this.ball.getPosition().y,r=this.ball.getPosition().z;void 0!==t&&i&&(r=t.getZ()+t.Span/2+this.ball.script.ball.Rad),this.makeBallExplode(s,a,r),this.ball.script.ball.getPos(this.ball.script.ball.RotAngle,this._vec3),this.makeTwoColorExplode(s,a,r,e,this.ball.script.ball.Color);var n=this.app.root.findByName("Camera");n&&n.script.cameraShake.Shake(),this.ball.enabled=!1,this.WaitTimeCntr=2.5,this.gameOver("collision",this.Score)}},Main.prototype.updateSpeeds=function(t){this.app.speedGame=void 0!==t?this.obstSpeed*this.gameSpeed*t:this.obstSpeed*this.gameSpeed,Main.GAMESPEED=this.gameSpeed},Main.prototype.clearObstacles=function(){for(var t=0;t<this.ZZags.length;t++)this.ZZags[t]&&this.ZZags[t].destroy();for(this.ZZags=[],t=0;t<this.Rings.length;t++)this.Rings[t].enabled&&this.Rings[t].script.ring.Off();for(t=0;t<this.ObstSave.length;t++)this.ObstSave[t].enabled&&this.ObstSave[t].script.circ.Off();for(t=0;t<this.StarSave.length;t++)this.StarSave[t].enabled&&this.StarSave[t].script.circ.Off();for(t=0;t<this.Pops.length;t++)this.Pops[t].enabled&&this.Pops[t].script.popText.Off()},Main.prototype.makeBallExplode=function(t,e,i){for(var s=Math.random()*Math.PI/4,a=0,r=2*Math.PI/15*.7,n=0;n<15;n++){a=s-r+2*r*Math.random();var o=this.getBallPart(),l=.3+1*Math.random(),h=.15+.05*Math.random();o.script.ballPart.Create(t,e,i,h,l*Math.cos(a),l*Math.sin(a),-l*Math.random()),o.script.ballPart.setColor(this.currColor),s+=2*Math.PI/15}},Main.prototype.makeColorExplode=function(t,e,i,s){for(var a=Math.random()*Math.PI/4,r=0,n=2*Math.PI/30*.7,o=0;o<30;o++){r=a-n+2*n*Math.random();var l=this.getBitPart(0),h=500+50*Math.random();l.script.bitPart.Create(t,e,i,0,this.BitColors[s],.2+.01*Math.random(),.15,r,h),a+=2*Math.PI/30}},Main.prototype.makeRingExplode=function(t,e,i){for(var s=0;s<t.ChunksNum;s++)for(var a=t.Chunks[s].script.chunk,r=t.Z,n=0;n<a.CircsNum;n++)for(var o=a.Circs[n].getX(),l=a.Circs[n].getY(),h=a.Circs[n].Color,p=Math.PI*Math.random(),c=p,d=Math.floor(e+i*Math.random()),g=.1+.02*Math.random(),u=2*Math.PI/d,b=0;b<d;b++){var m=o+g*Math.cos(p),f=l+g*Math.sin(p),M=this.getBitPart(0),S=.5+1*Math.random();p=(c+=u)-u/2+u*Math.random(),M.script.bitPart.Create(m,f,r,0,this.BitColors[h],.5*(.35+.2*Math.random()),.15,p,S)}},Main.prototype.makeBlockColorExplode=function(t,e,i){if(null!==e)for(var s=0;s<e.num;s+=2)for(var a=Math.PI*Math.random(),r=a,n=Math.floor(3+5*Math.random()),o=.025+.025*Math.random(),l=2*Math.PI/n,h=0;h<n;h++){var p=e.xy[s]+o*Math.cos(a),c=e.xy[s+1]+o*Math.sin(a),d=this.getBitPart(0),g=.5+4.5*Math.random();a=(r+=l)-l/2+l*Math.random(),d.script.bitPart.Create(p,c,i,0,this.BitColors[t],.5*(.35+.2*Math.random()),.15,a,g,.5,.65)}},Main.prototype.makeWhiteColorExplode=function(t,e,i){for(var s=Math.random()*Math.PI/4,a=0,r=2*Math.PI/3*.7,n=0;n<3;n++){a=s-r+2*r*Math.random();var o=this.getBitPart(1);if(null===o)return;var l=6+5*Math.random();o.script.bitPart.Create(t,e,i,1,this.ColorWhite,.2+.2*Math.random(),.15,a,l,1,0),s+=2*Math.PI/3}},Main.prototype.makeStarColorExplode=function(t,e,i,s){for(var a=Math.random()*Math.PI/4,r=0,n=2*Math.PI/15*.7,o=0;o<15;o++){r=a-n+2*n*Math.random();var l=this.getBitPart(1);if(null===l)return;var h=3+4*Math.random();l.script.bitPart.Create(t,e,i,1,this.BitColors[s],.1+.3*Math.random(),.15,r,h,.5,0),a+=2*Math.PI/15}},Main.prototype.makeTwoColorExplode=function(t,e,i,s,a){for(var r=Math.random()*Math.PI/4,n=0,o=2*Math.PI/20*.7,l=!1,h=0;h<20;h++){n=r-o+2*o*Math.random();var p=this.getBitPart(0),c=7+7*Math.random(),d=.2+.2*Math.random();l?p.script.bitPart.Create(t,e,i,0,this.BitColors[s],d,.2,n,c):p.script.bitPart.Create(t,e,i,0,this.BitColors[a],d,.2,n,c),r+=2*Math.PI/20,l=!l}},Main.prototype.getGlow=function(){for(var t=null,e=0;e<this.Glows.length;e++)if(!this.Glows[e].enabled){(t=this.Glows[e]).enabled=!0;break}if(null===t){var i=this.glowFlash;i&&(i.enabled?(t=i.clone(),this.app.root.addChild(t)):t=i,t.enabled=!0,this.Glows.push(t))}return t},Main.prototype.getShade=function(){for(var t=null,e=0;e<this.Shades.length;e++)if(!this.Shades[e].enabled){(t=this.Shades[e]).enabled=!0;break}if(null===t){var i=this.app.root.findByName("glowText");i&&(i.enabled?(t=i.clone(),this.app.root.addChild(t)):t=i,t.enabled=!0,this.Shades.push(t))}return t},Main.prototype.getPop=function(){for(var t=null,e=0;e<this.Pops.length;e++)if(!this.Pops[e].enabled){(t=this.Pops[e]).enabled=!0;break}if(null===t){var i=this.app.root.findByName("objText");i&&(i.enabled?(t=i.clone(),this.app.root.addChild(t)):t=i,t.enabled=!0,this.Pops.push(t))}return t},Main.prototype.getBitPart=function(t){for(var e,i=null,s=0;s<this.BitParts.length;s++)if(!this.BitParts[s].enabled&&this.BitParts[s].script.bitPart.Type===t){(i=this.BitParts[s]).enabled=!0;break}null===i&&(0===t&&(e=this.bitPapa),1===t&&(e=this.bitStarPapa),e&&(i=e.clone(),this.app.root.addChild(i),i.enabled=!0,this.BitParts.push(i)));return i},Main.prototype.getBallPart=function(){for(var t=null,e=0;e<this.BallParts.length;e++)if(!this.BallParts[e].enabled){(t=this.BallParts[e]).enabled=!0;break}if(null===t){var i=this.app.root.findByName("BallPart");i&&(t=i.clone(),this.app.root.addChild(t),t.enabled=!0,this.BallParts.push(t))}return t},Main.prototype.getTrace=function(){for(var t=null,e=0;e<this.Traces.length;e++)if(!this.Traces[e].enabled){(t=this.Traces[e]).enabled=!0;break}if(null===t){var i=this.sparkPapa;if(!i)return null;t=i.clone(),this.app.root.addChild(t),t.enabled=!0,this.Traces.push(t)}return t},Main.prototype.getStar=function(){for(var t=null,e=0;e<this.StarSave.length;e++)if(!this.StarSave[e].enabled){t=this.StarSave[e];break}if(null===t){var i=this.starPapa;if(!i)return null;(t=i.clone()).enabled=!0,this.StarSave.push(t)}return t},Main.prototype.onMouseDown=function(t){if(this.AllowGameInputFlag){if(this.gameState===GAME_INTRO){if(Input.mouseY<150)return;return this.DoPlay(),void(Game.instance.shop.enabled||Game.instance.onStartGame())}this.gameState==GAME_PLAYING&&this.ball.script.ball.onMouseDown(t.x,t.y)}},Main.prototype.onTouchDown=function(t){if(this.AllowGameInputFlag){if(this.gameState===GAME_INTRO){if(Input.mouseY<150)return;return this.DoPlay(),void Game.instance.onStartGame()}if(this.gameState==GAME_PLAYING){var e=t.changedTouches[0];this.ball.script.ball.onMouseDown(e.x,e.y)}}},Main.prototype.onTouchMove=function(t){if(this.gameState==GAME_PLAYING&&0!==Game.instance.slomo){var e=t.changedTouches[0];this.ball.script.ball.onMouseMove(e.x,e.y,!0)}},Main.prototype.onMouseMove=function(t){this.gameState==GAME_PLAYING&&0!==Game.instance.slomo&&this.ball.script.ball.onMouseMove(t.x,t.y,this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT))},Main.prototype.getObstacle=function(){for(var t=null,e=0;e<this.ObstSave.length;e++)if(!this.ObstSave[e].enabled){(t=this.ObstSave[e]).enabled=!0;break}if(null===t){var i=this.circPapa;if(!i)return null;(t=i.clone()).enabled=!0,this.ObstSave.push(t)}return t},Main.prototype.makeZigZag=function(){null===this.ZZag&&(this.ZZag=new pc.Entity,this.ZZag.addComponent("script"),this.ZZag.script.create("starsZig",{attributes:{type:0}}),this.ZZag.script.starsZig.setParams(this.matStars,this.StarColors),this.app.root.addChild(this.ZZag)),this.ZZag.script.starsZig.Create(this.ball.script.ball.Z-this.zzDistStart,this.zigRad,this.zzDist,this.zzDistStep,this.zzAngStep,this.starZZ,this.glowZZ,1,this.ball,0)},Main.prototype.getChunk=function(){for(var t=0;t<this.Chunks.length;t++)if(!this.Chunks[t].enabled)return this.Chunks[t].enabled=!0,this.Chunks[t];var e=new pc.Entity;return e.addComponent("script"),e.script.create("chunk",{attributes:{type:0}}),this.app.root.addChild(e),e.enabled=!0,this.Chunks.push(e),e},Main.prototype.getNearestRing=function(){for(var t,e=-1,i=0;i<this.Rings.length;i++)this.Rings[i].enabled&&this.Rings[i].script.ring.Z<-15&&(e<0||this.Rings[i].script.ring.Z>t)&&(e=i,t=this.Rings[i].script.ring.Z);return e>=0?this.Rings[e]:null},Main.prototype.getRing=function(){for(var t=0;t<this.Rings.length;t++)if(!this.Rings[t].enabled)return this.Rings[t].enabled=!0,this.Rings[t];var e=new pc.Entity;return e.addComponent("script"),e.script.create("ring",{attributes:{type:0}}),this.app.root.addChild(e),this.Rings.push(e),e},Main.prototype.createRing=function(t){var e=this.getRing(),i=this.AngleCircSpan,s=0,a=this.LevelDef.span;e.script.ring.Create(0,0,t,this.ball);for(var r=0;r<this.LevelDef.Circs.length;r++){var n,o,l,h,p,c,d,g,u=this.LevelDef.Circs[r],b=this.getChunk();b.script.chunk.Create(0,0,t,this.TransformZ,u.startAngle,this.ball,a);var m=Math.floor(Math.random()*this.colorsNum);m===this.oldColor&&++m>=this.colorsNum&&(m=0),this.oldColor=m,e.script.ring.setColor(m);for(var f=0;f<u.Blocks.length;f++){var M=u.Blocks[f];n=Math.ceil(M.fillAngle/i),(d=M.color+m)<0&&(d+=this.colorsNum),d>=this.colorsNum&&(d-=this.colorsNum);var S=0,C=M.startAngle;if(g=null,M.startAddAngle>0)for(o=Math.ceil(M.startAddAngle/i),p=0;p<o;p++)h=this.getObstacle(),c=M.startAngle-o*i+(p+1)*i,h.script.circ.Create(d,this.AngleCircSpan,0,c,this.obstRad,!1,1,a),h.model.meshInstances[0].material=this.materials[d].resource,h.script.circ.setSleep(!0),b.script.chunk.addCirc(h),(h=h.script.circ).SwingAngle0=h.Angle0,h.SwingAngle1=h.Angle0-i,h.SwingDir=1,h.SwingFlag=!0,h.SwingOrder=o-p-1,null===g&&(g=b.script.chunk.addBlock()),b.script.chunk.addToBlock(g,h);for(p=0;p<n;p++)h=this.getObstacle(),c=M.startAngle+p*i,h.script.circ.Create(d,this.AngleCircSpan,0,c,this.obstRad,!1,1,a),h.model.meshInstances[0].material=this.materials[d].resource,b.script.chunk.addCirc(h),S++,(h=h.script.circ).SwingFlag=!1,h.SwingOrder=-1,null===g&&(g=b.script.chunk.addBlock()),b.script.chunk.addToBlock(g,h);if(M.startAddAngle<0)for(o=Math.ceil(M.startAddAngle/i),o=Math.abs(o),p=0;p<o;p++)(h=b.script.chunk.getCircBack(S-p-1)).SwingAngle1=h.Angle0,h.SwingAngle0=h.Angle0+i,h.SwingDir=-1,h.SwingFlag=!0,h.SwingOrder=p,b.script.chunk.setOrderBlockCirc(g,h);if(M.fillAddAngle<0)for(l=Math.ceil(M.fillAddAngle/i),l=Math.abs(l),p=0;p<l;p++)(h=b.script.chunk.getCircBack(p)).SwingAngle1=h.Angle0,h.SwingAngle0=h.Angle0-i,h.SwingDir=-1,h.SwingFlag=!0,h.SwingOrder=p,b.script.chunk.setOrderBlockCirc(g,h);if(M.fillAddAngle>0)for(c=M.startAngle+(n-1)*i,l=Math.ceil(M.fillAddAngle/i),p=0;p<l;p++)(h=this.getObstacle()).script.circ.Create(d,this.AngleCircSpan,0,c+p*i,this.obstRad,!1,1,a),h.model.meshInstances[0].material=this.materials[d].resource,h.script.circ.setSleep(!0),b.script.chunk.addCirc(h),(h=h.script.circ).SwingAngle0=h.Angle0,h.SwingAngle1=h.Angle0+i,h.SwingDir=1,h.SwingFlag=!0,h.SwingOrder=p,null===g&&(g=b.script.chunk.addBlock()),b.script.chunk.addToBlock(g,h);if(null!==g&&b.script.chunk.setBlockTimes(g,M.delay,M.time),d==m&&0===s){h=this.getStar();var v=C+i*(S-1)/2,y=this.starRad,Z=.004*a/20;h.script.circ.Create(d,this.AngleStarSpan,b.script.chunk.Span0/2-Z,v,y,!0,.2,a),null!==g&&(g.star=h.script.circ,g.starFlag=!0),b.script.chunk.addStar(h),s++}}0!==u.angSpeed&&(b.script.chunk.setRotation(u.angSpeed),u.startAngle!==u.endAngle&&b.script.chunk.setRotationDest(u.endAngle,u.angSpeed)),e.script.ring.addChunk(b)}return e.script.ring.OnChunksAdded(),e},Main.prototype.initLevel=function(t,e,i){var s=90*randomInteger(0,3),a=this.entity.script.levels;return this.LevelDef=a.getLevelDef(t),void 0===this.LevelDef?null:(Math.random()<e?Math.random()<.5?this.LevelDef.Circs[0].angSpeed=i:this.LevelDef.Circs[0].angSpeed=-i:this.LevelDef.Circs[0].angSpeed=0,this.LevelDef.Circs[0].startAngle+=s,this.LevelDef.Circs[0].endAngle+=s,this.LevelDef.Circs[0].startAngle%=360,this.LevelDef.Circs[0].endAngle%=360,this.LevelCircIndex=0,this.LevelDef)},Main.prototype.makeRings=function(t){var e=this.obstDist*(t-1);this.LevelsIndex=6,this.initLevel(this.LevelsIndex);var i=this.createRing(this.obstBornZ+e-0*this.obstDist);i.script.ring.setRun(!1);for(var s=1;s<t;s++)this.LevelsIndex=11,this.initLevel(this.LevelsIndex),(i=this.createRing(this.obstBornZ+e-s*this.obstDist)).script.ring.setRun(!1)},Main.prototype.runRings=function(){for(var t=0;t<this.Rings.length;t++)this.Rings[t].enabled&&this.Rings[t].script.ring.setRun(!0)},Main.prototype.update=function(t){this.app;if(this.TraceRateCntr-=t*Game.instance.slomo,this.TraceRateCntr<0){var e=this.getTrace();if(e){e.script.trace.Create(0,0,this.traceZ,.25,.25,2,this.TraceAngle,this.traceRad,this.traceSpeed);var i=this.matTaces[Math.floor(Math.random()*this.matTaces.length)];e.model.meshInstances[0].material=i.resource}this.TraceRateCntr=this.TraceRate,this.TraceAngle+=Math.PI/5+Math.PI*Math.random()/2,this.TraceAngle>=2*Math.PI&&(this.TraceAngle-=2*Math.PI)}if(this.gameState,GAME_GAMEOVER,this.gameState==GAME_PLAYING&&0<Game.instance.slomo&&(this.obstDistCntr-=this.app.speedGame*t,this.obstDistCntr<=0)){completedLevels++,this.obstDistCntr=this.obstDist,this.LevelsIndexPrev=this.LevelsIndex;for(var s=0;s<10&&(this.LevelsIndex=pickRandom(completedLevels<20?easyLevels:midLevels),this.LevelsIndex==this.LevelsIndexPrev);s++);var a,r,n=Math.min(completedLevels,150)/150;this.gameSpeed=pc.math.lerp(.9,3,n),this.updateSpeeds(),this.TraceRate=pc.math.lerp(.35,.025,n),completedLevels<10?(a=0,r=0):completedLevels<60?(a=pickRandom(speedsMedium),r=.4):(a=pickRandom(speedsHard),r=.65),this.initLevel(this.LevelsIndex,r,a);this.createRing(this.obstBornZ);Math.random()>.8&&this.makeSmallZigZag(this.obstBornZ+14)}};var completedLevels=0,easyLevels=[8,9,10,11,12,13,14,21,23],midLevels=[1,2,3,6,7,15,16,17,18,19,20,22,4],speedsMedium=[45,60,90],speedsHard=[120,60,90,30];function pickRandom(t){return t[Math.floor(Math.random()*t.length)]}var Tub=pc.createScript("tube");Tub.attributes.add("materialAsset",{type:"asset"}),Tub.attributes.add("speed",{type:"vec2"}),Tub.prototype.initialize=function(){this.Z=0,this.materialAsset&&(this.material=this.materialAsset.resource);var t=this.entity.model.meshInstances[0].aabb.getMin(),e=this.entity.model.meshInstances[0].aabb.getMax();this.Distance=e.z-t.z,this.tube2=new pc.Entity;var s=this.app.assets.find("tube0.json","model");s&&(this.tube2.addComponent("model",{type:"asset",asset:s}),this.tube2.setLocalPosition(0,0,-this.Distance),this.entity.addChild(this.tube2)),this.RunFlag=!0,this.tmp=new pc.Vec2},Tub.prototype.setSpeed=function(){this.Speed=-this.Distance/this.app.speedGame},Tub.prototype.Run=function(t){this.RunFlag=t},Tub.prototype.update=function(t){this.RunFlag&&(this.Z+=this.app.speedGame*t*Game.instance.slomo,this.Z>=this.Distance&&(this.Z-=this.Distance),this.entity.setPosition(0,0,this.Z))};var Ball=pc.createScript("ball");Ball.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"Mats"}),Ball.attributes.add("radMove",{type:"number",default:1.3,title:"Move Radius"}),Ball.attributes.add("speedRunAmp",{type:"number",default:780}),Ball.attributes.add("speedSideAmp",{type:"number",default:500}),Ball.attributes.add("circCoeff",{type:"number",default:.014}),Ball.attributes.add("Zpos",{type:"number",default:-8}),Ball.attributes.add("starPapa",{type:"entity",title:"star"}),Ball.attributes.add("hvost",{type:"entity",title:"hvost"}),Ball.attributes.add("ballModel",{type:"entity",title:"ballModel"}),Ball.temp=new pc.Vec3,Ball.prototype.initialize=function(){this.firstTouch=!0,this.X=0,this.Y=0,this.Z=0,this.enableRotation=1,this.angVel=new pc.Vec3,this.Pos=new pc.Vec3,this.Stars=[];var t=this.entity.model.meshInstances[0].aabb.getMin(),s=this.entity.model.meshInstances[0].aabb.getMax();this.Rad=(s.x-t.x)/2,this.basePos=new pc.Vec3(0,0,this.Zpos),this.PI2=2*Math.PI,this.AngSpanColl=10,this.AngSpanCollHalf=this.AngSpanColl/2,this.X_last=0,this.setRotAngle(270),this.speedRun=this.speedRunAmp,this.speedSide=0,this.State=0,this.RollAngle=0,this.RollSideAngle=0,this.entity.getPosition(this.Pos),this.X=this.Pos.x,this.Y=this.Pos.y,this.Z=this.Pos.z,this.TraceDataIndex=0,this.TraceData=[],this.TraceDataNum=100;for(var a=0;a<this.TraceDataNum;a++)this.TraceData.push({ang:0,x:0,y:0,dist:0});this.Color=0,this.StarsGenStep=this.Rad/3,this.StarsGenStepRnd=this.Rad,this.StarsGenSpan=2*this.Rad,this.StarsGenSpanDist=0,this.StarsGenRate=.05,this.StarsGenRateCntr=0,this.StarsFlag=!1,this.StarColors=[(new pc.Color).fromString("#d455c4"),(new pc.Color).fromString("#dbc33a"),(new pc.Color).fromString("#24d5f5"),(new pc.Color).fromString("#de3f25")],this.StarColor=null},Ball.isRocket=!1,Ball.prototype.Revive=function(){this.State=0,this.firstTouch=!0,this.speedSide=0,this.setRotAngle(270),this.entity.setLocalEulerAngles(0,0,0),this.clearTraceData(this.RotAngle,this.X,this.Y,.05*this.app.speedGame),this.RollAngle=0,this.RollSideAngle=0,this.entity.setEulerAngles(0,-this.RollAngle,this.RotAngle),this.StarsFlag=!1,Ball.isRocket?this.ballModel.setEulerAngles(90,180,180):this.ballModel.setEulerAngles(0,0,0),this.X_last=Input.mouseX},Ball.prototype.getStarParticle=function(){for(var t=null,s=0;s<this.Stars.length;s++)if(!this.Stars[s].enabled){(t=this.Stars[s]).enabled=!0;break}null===t&&(t=this.starPapa.clone(),this.app.root.addChild(t),t.enabled=!0,this.Stars.push(t));return t},Ball.prototype.clearTraceData=function(t,s,a,e){for(var i=0;i<this.TraceDataNum;i++)this.TraceData[i].ang=t,this.TraceData[i].x=s,this.TraceData[i].y=a,this.TraceData[i].dist=e},Ball.prototype.setStars=function(t){t?this.hvost.script.hvost.setVisible(!1):this.hvost.script.hvost.setVisible(!0),this.StarsFlag=t,this.StarColor=this.StarColors[this.Color]},Ball.prototype.setStarsColor=function(t){this.StarColor=t},Ball.prototype.setMaterial=function(t){EntityTools.setMaterial(this.ballModel,t)},Ball.prototype.setColor=function(t){this.Color=t,this.setMaterial(this.materials[this.Color]),this.StarsFlag&&(this.StarColor=this.StarColors[this.Color])},Ball.prototype.setPlayState=function(){this.State=1,this.X_last=Input.mouseX,this.RotAngle=-89.9,this.RotAngle<0&&(this.RotAngle+=360),this.RotAngle>360&&(this.RotAngle-=360),this.updatePos()},Ball.prototype.setRotAngle=function(t){this.RotAngle=t,this.RotAngle<0&&(this.RotAngle+=360),this.RotAngle>360&&(this.RotAngle-=360),this.updatePos()},Ball.prototype.getPos=function(t,s){var a=Math.cos(Math.PI*t/180),e=Math.sin(Math.PI*t/180);s.x=this.basePos.x+this.radMove*a,s.y=this.basePos.y+this.radMove*e,s.z=this.basePos.z},Ball.prototype.getPosRad=function(t,s,a){var e=Math.cos(Math.PI*t/180),i=Math.sin(Math.PI*t/180);a.x=this.basePos.x+s*e,a.y=this.basePos.y+s*i,a.z=this.basePos.z},Ball.prototype.updatePos=function(){this.CosRot=Math.cos(Math.PI*this.RotAngle/180),this.SinRot=Math.sin(Math.PI*this.RotAngle/180),this.X=this.basePos.x+this.radMove*this.CosRot,this.Y=this.basePos.y+this.radMove*this.SinRot,this.Z=this.basePos.z,this.entity.setPosition(this.X,this.Y,this.Z),this.entity.setEulerAngles(0,0,this.RotAngle)},Ball.prototype.onMouseDown=function(t,s){if(0===Game.instance.slomo||!Main.instance.AllowGameInputFlag)return 1;this.X_last=t},Ball.prototype.onMouseMove=function(t,s,a){if(0===Game.instance.slomo||!Main.instance.AllowGameInputFlag)return 1;this.speedSide=0,a&&(Math.abs(t-this.X_last)&&(this.RotAngle+=(t-this.X_last)*this.circCoeff*(180/Math.PI)*.9*Game.instance.controlsSensivity,this.RotAngle<0&&(this.RotAngle+=360),this.RotAngle>360&&(this.RotAngle-=360),this.updatePos(),this.speedSide=this.speedSideAmp),this.X_last=t)},Ball.prototype.getTraces=function(t,s,a){var e=this.TraceDataIndex-1;e<0&&(e+=this.TraceDataNum);var i=0,l=0,h=0;for(t[i]=this.TraceData[e].ang,i++;;){if((h+=this.TraceData[e].dist)>=s){if(t[i]=this.TraceData[e].ang,++i>=a)return!0;h=0}if(--e<0&&(e+=this.TraceDataNum),++l>=this.TraceDataNum)return!1}},Ball.prototype.update=function(t){if(Main.instance.AllowGameInputFlag&&(this.RollAngle+=this.speedRunAmp*t*Game.instance.slomo),this.RollAngle>360&&(this.RollAngle-=360),this.enableRotation&&(this.angVel.x=-30*this.app.speedGame*Game.instance.slomo,this.angVel.z=0,Ball.temp.copy(this.angVel),Ball.temp.scale(t),0===this.State?this.ballModel.rotateLocal(90*t*0,0,0):this.ballModel.rotateLocal(Ball.temp)),this.speedSide=0,this.TraceData[this.TraceDataIndex].ang=this.RotAngle,this.TraceData[this.TraceDataIndex].x=this.X,this.TraceData[this.TraceDataIndex].y=this.Y,this.TraceData[this.TraceDataIndex].dist=Math.abs(this.app.speedGame*t),this.TraceDataIndex++,this.TraceDataIndex>=this.TraceDataNum&&(this.TraceDataIndex=0),this.StarsFlag)for(this.StarsGenRateCntr-=t;this.StarsGenRateCntr<0;){this.StarsGenRateCntr+=this.StarsGenRate;var s=this.getStarParticle(),a=this.StarsGenSpanDist-.5*this.StarsGenSpan;s.script.partStar.Create(this.X+this.SinRot*a,this.Y+this.CosRot*a,this.Z+this.Rad,0,this.StarColor,.3+.2*Math.random(),.1+.05*Math.random(),this.app.speedGame),this.StarsGenSpanDist+=this.StarsGenStep+this.StarsGenStepRnd*Math.random(),this.StarsGenSpanDist>this.StarsGenSpan&&(this.StarsGenSpanDist-=this.StarsGenSpan)}};var BallPart=pc.createScript("ballPart");BallPart.attributes.add("type",{type:"number",default:0}),BallPart.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"Mats"}),BallPart.prototype.initialize=function(){this.Pos=new pc.Vec3,this.RotVec=new pc.Vec3,this.enabled=!0,this.RunFlag=!1},BallPart.prototype.Create=function(t,e,s,i,a,h,n){this.Pos.z=s,this.Pos.x=t,this.Pos.y=e,this.entity.setPosition(this.Pos),this.speedz=n,this.speedy=h,this.speedx=a,this.TimeCntr=2.5,this.TimeScale=.5,this.angX=180*Math.random(),this.angY=180*Math.random(),this.angZ=180*Math.random(),this.entity.setLocalEulerAngles(this.angX,this.angY,this.angZ),this.angSpeedX=25+90*Math.random(),this.angSpeedY=25+90*Math.random(),this.angSpeedZ=25+90*Math.random(),Math.random()>.5&&(this.angSpeedX=-this.angSpeedX),Math.random()>.5&&(this.angSpeedY=-this.angSpeedY),Math.random()>.5&&(this.angSpeedZ=-this.angSpeedZ),this.Scale=i,this.ScaleSpeed=i/2,this.ScaleMin=this.Scale/3,this.entity.setLocalScale(this.Scale,this.Scale,this.Scale),this.RotVec.x=.5*Math.random(),this.RotVec.y=.5*Math.random(),this.RotVec.z=.5*Math.random(),this.Coeff=1,this.CoeffSpeed=.7,this.FadeFlag=!1,this.entity.enabled=!0,this.RunFlag=!0},BallPart.prototype.setColor=function(t){this.entity.model.meshInstances[0].material=this.materials[t].resource},BallPart.prototype.update=function(t){this.RunFlag&&((this.TimeCntr-=t)<0?this.entity.enabled=!1:(this.Pos.x+=this.speedx*t*this.Coeff*this.Coeff,this.Pos.y+=this.speedy*t*this.Coeff*this.Coeff,this.Pos.z+=this.speedz*t*this.Coeff*this.Coeff,this.Coeff-=this.CoeffSpeed*t,this.Coeff<.3&&(this.Coeff=.3),this.entity.setPosition(this.Pos),this.FadeFlag?(this.Scale-=this.ScaleSpeed*t,this.Scale<this.ScaleMin&&(this.Scale=this.ScaleMin),this.entity.setLocalScale(this.Scale,this.Scale,this.Scale)):this.TimeCntr<1.5&&(this.FadeFlag=!0),this.angX+=this.angSpeedX*t,this.angY+=this.angSpeedY*t,this.angZ+=this.angSpeedX*t,this.entity.setLocalEulerAngles(this.angX,this.angY,this.angZ)))};var Circ=pc.createScript("circ");Circ.prototype.initialize=function(){this.Xc=0,this.Yc=0,this.Z=0,this.SpriteFlag=!1,this.Span=0,this.Span0=0,this.ActiveFlag=!1},Circ.prototype.Create=function(t,i,e,s,h,n,o,a){if(this.Xc=0,this.Yc=0,this.Z=e,this.RadRot0=h,this.RadRot=h,this.Color=t,this.AngSpan=i,this.AngSpanHalf=this.AngSpan/2,this.Layer=0,this.LayerIndex=0,this.LayerAngle=0,this.entity.enabled=!0,this.scaleCoeff=o,this.SwingFlag=!1,this.SwingDoneFlag=!1,this.SleepFlag=!1,this.Block=null,this.SpanCoeff=a,this.setScale(1),this.SpriteFlag=n,this.SpriteFlag);else{var l=this.entity.model.meshInstances[0].aabb.getMin(),c=this.entity.model.meshInstances[0].aabb.getMax();this.Span0=c.z-l.z,this.Span=this.SpanCoeff*this.Span0}this.setAngle(s),this.RotFlag=!1,this.setSleep(!1),this.Scale=1,this.RadCoeff=1,this.ScalingFlag=!1,this.RadCoeffFlag=!1,this.RunFlag=!0,this.RotateFlag=!1,this.ActiveFlag=!0},Circ.prototype.getWidth=function(){var t=this.entity.model.meshInstances[0].aabb.getMin();return this.entity.model.meshInstances[0].aabb.getMax().x-t.x},Circ.prototype.setRotate=function(t,i,e,s,h){this.RotateFlag&&this.setAngle(this.AngleDest),this.AngleRotate0=this.Angle0,this.AngleDest=t,this.AngleDest<0&&(this.AngleDest+=360),this.AngleDest<0&&(this.AngleDest+=360),this.AngleDest>360&&(this.AngleDest-=360),this.AngleDest>360&&(this.AngleDest-=360),this.AngleDest=t,this.BlockSwing=h,this.dAngleRotate=this.AngleDest-this.Angle0,Math.abs(this.dAngleRotate)>180&&(this.dAngleRotate<0?this.dAngleRotate=360+this.dAngleRotate:this.dAngleRotate=this.dAngleRotate-360),this.RotCoeff=0,this.RotCoeffSpeed=1/i,this.RotateFunc=e,this.RotateFuncContex=s,this.RotateFlag=!0},Circ.prototype.setAngle=function(t){this.Angle0=t,this.Angle0<0&&(this.Angle0+=360),this.Angle0<0&&(this.Angle0+=360),this.Angle0>360&&(this.Angle0-=360),this.Angle0>360&&(this.Angle0-=360),this.CosRot=Math.cos(Math.PI*this.Angle0/180),this.SinRot=Math.sin(Math.PI*this.Angle0/180),this.X=this.Xc+this.CosRot*this.RadRot,this.Y=this.Yc+this.SinRot*this.RadRot,this.entity.setLocalPosition(this.X,this.Y,this.Z),this.entity.setLocalEulerAngles(0,0,this.Angle0)},Circ.prototype.fillBlockXYs=function(t){t.num=0;for(var i=0;i<this.Block.circsNum;i++)t.xy[t.num]=this.Block.circs[i].getX(),t.num++,t.xy[t.num]=this.Block.circs[i].getY(),t.num++},Circ.prototype.getX=function(){return this.entity.getPosition().x},Circ.prototype.getY=function(){return this.entity.getPosition().y},Circ.prototype.getZ=function(){return this.entity.getPosition().z},Circ.prototype.setSleep=function(t){this.SpriteFlag||(this.entity.model.meshInstances[0].visible=!t),this.SleepFlag=t},Circ.prototype.setRadCoeff=function(t){this.RadCoeff=t,this.RadRot=this.RadRot0*t,this.X=this.Xc+this.CosRot*this.RadRot,this.Y=this.Yc+this.SinRot*this.RadRot,this.entity.setLocalPosition(this.X,this.Y,this.Z)},Circ.prototype.getMinAngleToBall=function(t,i,e){},Circ.prototype.getMinAngle=function(t,i,e){var s=Math.abs(t-(this.Angle0+e));return s>360&&(s-=360),s>360&&(s-=360),s>360-s&&(s=360-s),s-(i+this.AngSpanHalf)},Circ.prototype.getMinAngleCenter=function(t,i){var e=Math.abs(t-(this.Angle0+i));return e>360&&(e-=360),e>360&&(e-=360),e>360-e&&(e=360-e),e-this.AngSpanHalf},Circ.prototype.setScale=function(t){this.Scale=t,this.entity.setLocalScale(this.Scale*this.scaleCoeff,this.Scale*this.scaleCoeff,this.Scale*this.scaleCoeff)},Circ.prototype.setScaleDest=function(t,i){this.ScaleDest=t,this.ScaleSpeed=(this.ScaleDest-this.Scale)/i,this.ScalingFlag=!0},Circ.prototype.setRadCoeffDest=function(t,i){this.RadCoeffDest=t,this.RadCoeffSpeed=(this.RadCoeffDest-this.RadCoeff)/i,this.RadCoeffFlag=!0},Circ.prototype.Off=function(){this.ActiveFlag&&(this.entity.enabled=!1,this.ActiveFlag=!1)},Circ.prototype.update=function(t){this.RotateFlag&&0<Game.instance.slomo&&(this.Angle0=this.AngleRotate0+this.RotCoeff*this.dAngleRotate,this.RotCoeff+=this.RotCoeffSpeed*t,this.RotCoeff>=1&&(this.RotCoeff=1,this.Angle0=this.AngleDest,this.RotateFlag=!1,null!==this.RotateFunc&&this.RotateFunc.call(this.RotateFuncContex,this,this.BlockSwing)),this.setAngle(this.Angle0))};var Splash=pc.createScript("splash");Splash.attributes.add("materialAsset",{type:"asset",assetType:"material",array:!1,title:"Material"}),Splash.prototype.initialize=function(){this.FadeFlag=!1,this.AlphaSpeed=0,this.Alpha=0,this.material=null,this.materialAsset&&(this.material=this.materialAsset.resource),this.material.blendType=pc.BLEND_NORMAL,this.material.opacity=this.Alpha,this.material.update()},Splash.prototype.setFadeIn=function(t,a,i){this.func=a,this.funcCont=i,this.WaitTimeCntr=t,this.FadeFlag=!0,this.Alpha=0,this.material.opacity=this.Alpha,this.material.update(),this.AlphaSpeed=4,this.entity.enabled=!0},Splash.prototype.setFadeOut=function(t,a,i){this.func=a,this.funcCont=i,this.WaitTimeCntr=t,this.FadeFlag=!0,this.Alpha=1,this.material.opacity=this.Alpha,this.material.update(),this.AlphaSpeed=-1/.75,this.entity.enabled=!0},Splash.prototype.update=function(t){this.FadeFlag&&(this.WaitTimeCntr-=t)<0&&(this.Alpha+=this.AlphaSpeed*t,this.Alpha>1&&this.AlphaSpeed>0&&(this.Alpha=1,this.FadeFlag=!1,this.app.fire("spash:in")),this.Alpha<0&&this.AlphaSpeed<0&&(this.Alpha=0,this.FadeFlag=!1,this.entity.enabled=!1,this.app.fire("spash:out")),this.material.opacity=this.Alpha,this.material.update())};var Levels=pc.createScript("levels");function randomInteger(e,l){var s=e-.5+Math.random()*(l-e+1);return s=Math.round(s)}Levels.prototype.initialize=function(){this.Levels=[],this.AngBlock=10},Levels.prototype.levelAddStar=function(e,l){},Levels.prototype.levelRotateCircle=function(e,l,s,t){var d;void 0===this.Levels[e]&&(d={id:e,Circs:[],Stars:null,span:8},this.Levels[e]=d);var i={startAngle:l+5,endAngle:s+5,angSpeed:t};return(d=this.Levels[e]).Circs.push(i),i},Levels.randomAddAngle=0,Levels.prototype.levelAddBlocks=function(e,l,s,t,d,i,c,o){var v;void 0===this.Levels[e]&&(v={id:e,Circs:[],Stars:null,span:1},this.Levels[e]=v),0===(v=this.Levels[e]).Circs.length&&v.Circs.push({startAngle:0,endAngle:0,angSpeed:0});var h=v.Circs[v.Circs.length-1];void 0===h.Blocks&&(h.Blocks=[]);var a={startAngle:l,fillAngle:s,startAddAngle:t,fillAddAngle:d,star:!1,color:i,delay:c,time:o};return h.Blocks.push(a),a},Levels.prototype.getLevelDef=function(e){if(console.log(e),void 0!==this.Levels[e])return this.Levels[e];switch(e){case 23:this.levelRotateCircle(e,0,0,0),this.levelAddBlocks(e,0,120,0,0,0,0,1),this.levelAddBlocks(e,120,240,0,0,3,0,1);break;case 22:this.levelRotateCircle(e,0,0,45),this.levelAddBlocks(e,-30,60,30,30,0,0,.6),this.levelAddBlocks(e,120,120,60,60,2,0,.6);break;case 21:this.levelRotateCircle(e,0,0,0),this.levelAddBlocks(e,0,120,0,0,0,0,1),this.levelAddBlocks(e,120,240,0,0,3,0,1);break;case 20:this.levelRotateCircle(e,0,0,0),this.levelAddBlocks(e,0,50,0,0,0,0,1),this.levelAddBlocks(e,50,90,0,0,2,0,1),this.levelAddBlocks(e,140,150,0,0,3,0,1),this.levelAddBlocks(e,290,70,0,0,1,0,1);break;case 19:this.levelRotateCircle(e,0,0,45),this.levelAddBlocks(e,0,50,0,0,3,0,1),this.levelAddBlocks(e,50,90,0,0,0,0,1),this.levelAddBlocks(e,140,150,0,0,1,0,1),this.levelAddBlocks(e,290,40,0,0,2,0,1);break;case 18:this.levelRotateCircle(e,0,0,-40),this.levelAddBlocks(e,0,20,0,90,3,0,1),this.levelAddBlocks(e,120,20,0,90,1,0,1),this.levelAddBlocks(e,240,20,0,90,0,0,1);break;case 17:this.levelRotateCircle(e,0,0,0),this.levelAddBlocks(e,0,30,0,90,1,0,2),this.levelAddBlocks(e,120,30,0,90,0,0,2),this.levelAddBlocks(e,240,30,0,90,2,0,2);break;case 16:this.levelRotateCircle(e,0,0,-120),this.levelAddBlocks(e,0,60,0,30,1,0,2),this.levelAddBlocks(e,180,60,0,30,0,0,2);break;case 15:this.levelRotateCircle(e,0,0,140),this.levelAddBlocks(e,0,60,30,0,0,0,2),this.levelAddBlocks(e,180,60,30,0,1,0,2);break;case 21:this.levelRotateCircle(e,0,0,-70),this.levelAddBlocks(e,60,120,0,0,0,0,1.5),this.levelAddBlocks(e,180,60,0,180,1,0,2);break;case 14:this.levelRotateCircle(e,0,0,70),this.levelAddBlocks(e,0,60,0,180,3,0,3),this.levelAddBlocks(e,240,120,0,0,0,0,2);break;case 13:this.levelRotateCircle(e,0,0,-90),this.levelAddBlocks(e,190,60,0,0,0,0,2),this.levelAddBlocks(e,250,300,0,0,1,0,2);break;case 12:this.levelRotateCircle(e,0,0,60),this.levelAddBlocks(e,0,60,0,0,0,0,2),this.levelAddBlocks(e,60,300,0,0,2,0,2);break;case 11:this.levelRotateCircle(e,0,0,45),this.levelAddBlocks(e,0,120,0,0,2,0,2),this.levelAddBlocks(e,120,120,0,0,1,0,2),this.levelAddBlocks(e,240,120,0,0,0,0,2);break;case 10:this.levelRotateCircle(e,0,0,-45),this.levelAddBlocks(e,0,120,0,0,1,0,2),this.levelAddBlocks(e,120,120,0,0,0,0,2),this.levelAddBlocks(e,240,120,0,0,2,0,2);break;case 9:this.levelRotateCircle(e,0,0,45),this.levelAddBlocks(e,0,180,0,0,0,0,2),this.levelAddBlocks(e,180,180,0,0,3,0,2);break;case 8:this.levelRotateCircle(e,0,0,-45),this.levelAddBlocks(e,0,180,0,0,2,0,2),this.levelAddBlocks(e,180,180,0,0,0,0,2);break;case 7:this.levelRotateCircle(e,0,0,-70),this.levelAddBlocks(e,0,90,0,0,0,0,2),this.levelAddBlocks(e,90,90,0,0,1,0,2),this.levelAddBlocks(e,180,90,0,0,2,0,2),this.levelAddBlocks(e,270,90,0,0,3,0,2);break;case 6:this.levelRotateCircle(e,45,0,0),this.levelAddBlocks(e,0,90,0,0,0,0,2),this.levelAddBlocks(e,90,90,0,0,1,0,2),this.levelAddBlocks(e,180,90,0,0,2,0,2),this.levelAddBlocks(e,270,90,0,0,3,0,2);break;case 0:this.levelRotateCircle(e,0,0,90),this.levelAddBlocks(e,0,90,0,0,0,0,2),this.levelAddBlocks(e,90,90,0,0,1,0,2),this.levelAddBlocks(e,180,90,0,0,2,0,2);break;case 1:this.levelRotateCircle(e,0,0,0),this.levelAddBlocks(e,90,90,0,0,1,0,2),this.levelAddBlocks(e,180,90,0,0,0,0,2),this.levelAddBlocks(e,270,90,0,0,3,0,2);break;case 2:this.levelRotateCircle(e,0,0,30),this.levelAddBlocks(e,0,60,0,0,0,0,2),this.levelAddBlocks(e,90,60,0,0,1,0,2),this.levelAddBlocks(e,180,60,0,0,2,0,2),this.levelAddBlocks(e,270,60,0,0,3,0,2);break;case 3:this.levelRotateCircle(e,0,0,-60),this.levelAddBlocks(e,0,30,0,90,2,0,1),this.levelAddBlocks(e,120,30,0,90,1,0,1),this.levelAddBlocks(e,240,30,0,90,0,0,1);break;case 4:this.levelRotateCircle(e,0,0,0),this.levelAddBlocks(e,0,90,0,0,3,0,0),this.levelAddBlocks(e,90,30,0,60,2,0,1),this.levelAddBlocks(e,180,90,0,0,1,0,0),this.levelAddBlocks(e,270,30,0,60,0,0,1)}return this.Levels[e]};var Trace=pc.createScript("trace");Trace.attributes.add("type",{type:"number",default:0}),Trace.prototype.initialize=function(){this.Pos=new pc.Vec3,this.RunFlag=!1,this.enabled=!0},Trace.prototype.Create=function(t,s,i,e,o,h,n,a,c){this.Pos.z=i,this.Xc=t,this.Yc=s,this.speed=c,this.radMove=a,this.setRotAngle(n),this.entity.setLocalScale(e,o,h),this.RunFlag=!0,this.entity.enabled=!0},Trace.prototype.setRotAngle=function(t){this.RotAngle=t,this.CosRot=Math.cos(this.RotAngle),this.SinRot=Math.sin(this.RotAngle),this.Pos.x=this.Xc+this.radMove*this.CosRot,this.Pos.y=this.Yc+this.radMove*this.SinRot,this.entity.setPosition(this.Pos),this.entity.setLocalEulerAngles(0,0,180*(this.RotAngle+Math.PI/2)/Math.PI)},Trace.prototype.update=function(t){this.RunFlag&&(this.Pos.z+=this.speed*t*Game.instance.slomo,this.entity.setPosition(this.Pos),this.Pos.z>1&&(this.entity.enabled=!1,this.RunFlag=!1))};var Chunk=pc.createScript("chunk");Chunk.prototype.initialize=function(){this.Z_tokill=0,this.RunFlag=!1,this.Circs=[],this.CircEnts=[],this.Stars=[],this.Blocks=[],this.SwingFlag=!0,this.ActiveFlag=!1},Chunk.prototype.Create=function(t,i,s,r,e,c,h){this.X=t,this.Y=i,this.Z=s,this.Z_edge=r,this.ball=c,this.Z_ball=this.ball.getPosition().z,this.RadBall=this.ball.script.ball.Rad,this.BallAngColl=this.ball.script.ball.AngSpanColl,this.BlocksNum=0,this.SwingFlag=!0,this.SpanCoeff=h,this.entity.setPosition(this.X,this.Y,this.Z),this.entity.setLocalScale(1,1,.5*this.SpanCoeff),this.setRotAngle(e),this.CircsNum=0,this.StarsNum=0,this.Span=0,this.Span0=0,this.RotDestFlag=!1,this.RotFlag=!1,this.RadCoeffFlag=!1,this.RadCoeff=1,this.Scale=1,this.ScalingFlag=!1,this.DisappearFlag=!1,this.TransformedFlag=!1,this.RunFlag=!0,this.ActiveFlag=!0},Chunk.prototype.addBlock=function(){var t;return void 0===this.Blocks[this.BlocksNum]?(t={circs:[],circsNum:0},this.Blocks[this.BlocksNum]=t):t=this.Blocks[this.BlocksNum],this.BlocksNum++,t.circsNum=0,t.ordersNum=0,t.order=0,t.orderDir=1,t.delay=0,t.circsCntr=0,t.timeSwing=.25,t.time=1,t.state=0,t.starFlag=!1,t.star=null,t.first=-1,t.last=-1,t},Chunk.prototype.getBlockCenter=function(t){for(var i=-1,s=0,r=0,e=0;e<t.circsNum;e++)t.circs[e].SleepFlag||(r++,t.circs[e].RotateFlag?i<0?(i=e,s=t.circs[e].AngleDest,t.circs[e].SwingDir<0&&r--):t.circs[e].SwingDir<0&&r--:i<0&&(i=e,s=t.circs[e].Angle0));return i<0?0:s+10*(r-1)/2},Chunk.prototype.setBlockTimes=function(t,i,s){t.delay=i;var r=s;r<=0&&(r=.5),t.time=r,t.timeSwing=r/t.ordersNum},Chunk.prototype.addToBlock=function(t,i){t.circs[t.circsNum]=i,i.Block=t,t.circsNum++,i.SwingOrder>t.ordersNum-1&&(t.ordersNum=i.SwingOrder+1)},Chunk.prototype.setOrderBlockCirc=function(t,i){i.SwingOrder>t.ordersNum-1&&(t.ordersNum=i.SwingOrder+1)},Chunk.prototype.OnSwingFinishRotate=function(t,i){var s;if(t.SwingDoneFlag=!0,t.SwingDir<0&&t.setSleep(!0),this.SwingFlag&&(i.circsCntr--,i.circsCntr<=0)){if(i.circsCntr=0,i.order+=i.orderDir,i.orderDir>0&&i.order>=i.ordersNum||i.orderDir<0&&i.order<0){for(s=0;s<i.circsNum;s++)i.circs[s].SwingDoneFlag=!1,i.circs[s].SwingDir>0?i.circs[s].SwingDir=-1:i.circs[s].SwingDir=1;return i.order-=i.orderDir,i.orderDir<0?i.orderDir=1:i.orderDir=-1,void this.startBlockSwing(i)}for(s=0;s<i.circsNum;s++)i.circs[s].SwingOrder===i.order&&(i.circs[s].SwingDir>0?(i.circs[s].setRotate(i.circs[s].SwingAngle1,i.timeSwing,this.OnSwingFinishRotate,this,i),i.circs[s].setSleep(!1)):i.circs[s].setRotate(i.circs[s].SwingAngle0,i.timeSwing,this.OnSwingFinishRotate,this,i),i.circsCntr++);if(i.starFlag){var r=this.getBlockCenter(i);i.star.setRotate(r,i.timeSwing,null,null,i)}}},Chunk.prototype.startBlockSwing=function(t){t.circsCntr=0;for(var i=0;i<t.circsNum;i++)t.circs[i].SwingOrder===t.order&&(t.circs[i].SwingDir>0?(t.circs[i].setRotate(t.circs[i].SwingAngle1,t.timeSwing,this.OnSwingFinishRotate,this,t),t.circs[i].setSleep(!1)):t.circs[i].setRotate(t.circs[i].SwingAngle0,t.timeSwing,this.OnSwingFinishRotate,this,t),t.circsCntr++);if(t.starFlag){var s=this.getBlockCenter(t);t.star.setRotate(s,t.timeSwing,null,null,t)}},Chunk.prototype.OnCircsAdded=function(){this.entity.setPosition(this.X,this.Y,this.Z),this.setScaleCircs(1),this.setRadCoeffCircs(1)},Chunk.prototype.setDisappear=function(){this.setScaleDest(0,.15),this.DisappearFlag=!0},Chunk.prototype.OnBallCollide=function(){this.Off()},Chunk.prototype.setScaleDest=function(t,i){for(var s=0;s<this.CircsNum;s++)this.Circs[s].ActiveFlag&&this.Circs[s].setScaleDest(t,i);for(s=0;s<this.StarsNum;s++)this.Stars[s].ActiveFlag&&this.Stars[s].setScaleDest(t,i)},Chunk.prototype.setScaleDestLayer=function(t,i,s){for(var r=0;r<this.CircsNum;r++)this.Circs[r].ActiveFlag&&this.Circs[r].Layer===s&&this.Circs[r].setScaleDest(t,i);for(r=0;r<this.StarsNum;r++)this.Stars[r].ActiveFlag&&this.Stars[r].Layer===s&&this.Stars[r].setScaleDest(t,i)},Chunk.prototype.setRadCoeffDest=function(t,i){for(var s=0;s<this.CircsNum;s++)this.Circs[s].ActiveFlag&&this.Circs[s].setRadCoeffDest(t,i);for(s=0;s<this.StarsNum;s++)this.Stars[s].ActiveFlag&&this.Stars[s].setRadCoeffDest(t,i)},Chunk.prototype.setRadCoeffDestLayer=function(t,i,s){for(var r=0;r<this.CircsNum;r++)this.Circs[r].ActiveFlag&&this.Circs[r].Layer===s&&this.Circs[r].setRadCoeffDest(t,i);for(r=0;r<this.StarsNum;r++)this.Stars[r].ActiveFlag&&this.Stars[r].Layer===s&&this.Stars[r].setRadCoeffDest(t,i)},Chunk.prototype.setScaleCircs=function(t){this.Scale=t;for(var i=0;i<this.CircsNum;i++)this.Circs[i].ActiveFlag&&this.Circs[i].setScale(this.Scale);for(i=0;i<this.StarsNum;i++)this.Stars[i].ActiveFlag&&this.Stars[i].setScale(this.Scale)},Chunk.prototype.setScaleCircsLayer=function(t,i){this.Scale=t;for(var s=0;s<this.CircsNum;s++)this.Circs[s].ActiveFlag&&this.Circs[s].Layer===i&&this.Circs[s].setScale(this.Scale);for(s=0;s<this.StarsNum;s++)this.Stars[s].ActiveFlag&&this.Stars[s].Layer===i&&this.Stars[s].setScale(this.Scale)},Chunk.prototype.setRadCoeffCircs=function(t){this.RadCoeff=t;for(var i=0;i<this.CircsNum;i++)this.Circs[i].ActiveFlag&&this.Circs[i].setRadCoeff(this.RadCoeff);for(i=0;i<this.StarsNum;i++)this.Stars[i].ActiveFlag&&this.Stars[i].setRadCoeff(this.RadCoeff)},Chunk.prototype.setRadCoeffCircsLayer=function(t,i){this.RadCoeff=t;for(var s=0;s<this.CircsNum;s++)this.Circs[s].ActiveFlag&&this.Circs[s].Layer===i&&this.Circs[s].setRadCoeff(this.RadCoeff);for(s=0;s<this.StarsNum;s++)this.Stars[s].ActiveFlag&&this.Stars[s].Layer===i&&this.Stars[s].setRadCoeff(this.RadCoeff)},Chunk.prototype.getCirc=function(t){return this.Circs[t]},Chunk.prototype.getCircBack=function(t){return this.Circs[this.CircsNum-t-1]},Chunk.prototype.setCircsSleepLayer=function(t,i){for(var s=0;s<this.CircsNum;s++)this.Circs[s].ActiveFlag&&this.Circs[s].Layer===i&&this.Circs[s].setSleep(t)},Chunk.prototype.setStarsSleepLayer=function(t,i){for(var s=0;s<this.StarsNum;s++)this.Stars[s].ActiveFlag&&this.Stars[s].Layer===i&&this.Stars[s].setSleep(t)},Chunk.prototype.setRotationDest=function(t,i){this.RotAngleSpeed=i,this.RotDestAngle=Math.abs(t-this.RotAngle),this.RotDestFlag=!0,this.RotFlag=!0},Chunk.prototype.setRotation=function(t){this.RotAngleSpeed=t,this.RotDestFlag=!1,this.RotFlag=!0},Chunk.prototype.setRotAngle=function(t){this.RotAngle=t,this.setRotAngle>360&&(this.setRotAngle-=360),this.setRotAngle<0&&(this.setRotAngle+=360),this.entity.setEulerAngles(0,0,this.RotAngle)},Chunk.prototype.setCircsLayer=function(t,i,s){for(var r=i;r<i+s;r++)this.Circs[r].Layer=t},Chunk.prototype.setCircsLayerBack=function(t,i){for(var s=0;s<i;s++)this.Circs[this.CircsNum-1-s].Layer=t},Chunk.prototype.addCirc=function(t){this.Circs[this.CircsNum]=t.script.circ,this.CircEnts[this.CircsNum]=t,this.CircsNum++,t.parent?t.reparent(this.entity):this.entity.addChild(t),t.script.circ.Span>this.Span&&(this.Span=t.script.circ.Span,this.Span0=t.script.circ.Span0)},Chunk.prototype.checkParents=function(){for(var t=0,i=0;i<this.CircsNum;i++)this.CircEnts[i].parent!==this.entity&&t++;return t},Chunk.prototype.addStar=function(t){this.Stars[this.StarsNum]=t.script.circ,this.StarsNum++,t.parent?t.reparent(this.entity):this.entity.addChild(t)},Chunk.prototype.Stop=function(){this.RunFlag=!1,this.SwingFlag=!1},Chunk.prototype.Off=function(){if(this.ActiveFlag){var t;for(t=0;t<this.CircsNum;t++)this.Circs[t].ActiveFlag&&this.Circs[t].Off();for(this.CircsNum=0,t=0;t<this.StarsNum;t++)this.Stars[t].ActiveFlag&&this.Stars[t].Off();for(this.StarsNum=0,t=this.entity.children.length;t--;)this.entity.children[t]instanceof pc.Entity&&this.entity.removeChild(this.entity.children[t]);this.entity.enabled=!1,this.ActiveFlag=!1}},Chunk.prototype.getZ=function(){return this.Z},Chunk.prototype.checkOnBall=function(t,i,s){for(var r,e=180,c=-1,h=!0,n=0;n<this.CircsNum;n++)this.Circs[n].ActiveFlag&&!1===this.Circs[n].SleepFlag&&(r=this.Circs[n].getMinAngleCenter(t,this.RotAngle))<e&&(e=r,c=n);if(e>0)for(h=!1,n=0;n<this.CircsNum;n++)this.Circs[n].ActiveFlag&&!1===this.Circs[n].SleepFlag&&(r=this.Circs[n].getMinAngle(t,i,this.RotAngle))<e&&(e=r,c=n);if(s.ang=e,c<0)return!1;if(s.circ=this.Circs[c],s.star=null,s.angStar=0,s.centFlag=h,this.StarsNum>0){for(e=180,c=0,n=0;n<this.StarsNum;n++)(r=this.Stars[n].getMinAngle(t,i,this.RotAngle))<e&&(e=r,c=n);s.angStar=e,s.star=this.Stars[c]}return!0},Chunk.prototype.setZ=function(t,i){this.Z=t,this.entity.setPosition(this.X,this.Y,this.Z),this.RotFlag&&(this.RotAngle+=this.RotAngleSpeed*i,this.RotAngle>360&&(this.RotAngle-=360),this.RotAngle<0&&(this.RotAngle+=360),this.entity.setEulerAngles(0,0,this.RotAngle),this.RotDestFlag&&(this.RotDestAngle-=this.RotAngleSpeed*i,this.RotDestAngle<=0&&(this.RotFlag=!1,this.RotDestFlag=!1)));for(var s=0;s<this.BlocksNum;s++)0===this.Blocks[s].state&&(this.Blocks[s].delay-=i,this.Blocks[s].delay<0&&(this.Blocks[s].state=1,this.startBlockSwing(this.Blocks[s])))};var CameraShake=pc.createScript("cameraShake");CameraShake.prototype.initialize=function(){this.enabled=!1},CameraShake.prototype.Shake=function(){var t=this.entity.getPosition();this.X0=t.x,this.Y0=t.y,this.Z0=t.z,this.X=0,this.Y=0,this.Z=0,this.TimeCntr=.75,this.TimeFade=.5*this.TimeCntr,this.Speed=5,this.Angle=Math.random()*Math.PI,this.AngleStep=Math.PI/6,this.AngleStepRnd=2*Math.PI/3,this.Rad0=.01,this.RadRnd=.03,this.FadeFlag=!1,this.setNewRun(),this.SpeedZ=-5,this.TimeZ=.15,this.SpeedZState=0,this.Scale=1,this.ScaleSpeed=2,this.enabled=!0},CameraShake.prototype.setNewRun=function(){this.Angle+=this.AngleStep+this.AngleStepRnd*Math.random(),this.Rad=this.Rad0+this.RadRnd*Math.random(),this.X_dest=this.Rad*Math.cos(this.Angle),this.Y_dest=this.Rad*Math.sin(this.Angle),this.FadeFlag&&(this.X_dest=0,this.Y_dest=0),this.Dist=Math.sqrt((this.X-this.X_dest)*(this.X-this.X_dest)+(this.Y-this.Y_dest)*(this.Y-this.Y_dest)),0===this.Dist&&(this.Dist=.01),this.SpeedX=this.Speed*(this.X_dest-this.X)/this.Dist,this.SpeedY=this.Speed*(this.Y_dest-this.Y)/this.Dist},CameraShake.prototype.Off=function(){this.entity.setPosition(this.X0,this.Y0,this.Z0),this.enabled=!1},CameraShake.prototype.update=function(t){if(this.X+=this.SpeedX*t,this.Y+=this.SpeedY*t,this.SpeedZState>=0&&(this.Z+=this.SpeedZ*t,this.TimeZ-=t,0===this.SpeedZState?this.TimeZ<=0&&(this.SpeedZState=1,this.SpeedZ=2):this.Z>=0&&(this.Z=0,this.SpeedZState=-1)),this.entity.setPosition(this.X0+this.X*this.Scale,this.Y0+this.Y*this.Scale,this.Z0+this.Z),this.Dist-=this.Speed*t,this.Dist<=0){if(this.setNewRun(),this.FadeFlag)return void this.Off();this.setNewRun()}this.TimeCntr<this.TimeFade&&(this.Scale-=this.ScaleSpeed*t,this.Scale<.2&&(this.Scale=.2)),!this.FadeFlag&&(this.TimeCntr-=t)<=0&&(this.FadeFlag=!0,this.setNewRun())};var UiScore=pc.createScript("uiscore");UiScore.prototype.initialize=function(){this.scoreNum=0,this.Alpha=1,this.FadeFlag=!1,this.Scale=1,this.ScalingFlag=!1,this.ColorShade=(new pc.Color).fromString("#000000"),this.shadowVec2=new pc.Vec2(0,0)},UiScore.prototype.setFading=function(t,e,i){this.AlphaDest=t,this.AlphaSpeed=(this.AlphaDest-this.Alpha)/e,this.FadeKillFlag=i,this.FadeFlag=!0},UiScore.prototype.setAlpha=function(t){this.Alpha=t,this.entity.element.opacity=this.Alpha},UiScore.prototype.setScaling=function(t,e,i){this.ScaleDest=t,this.ScaleSpeed=(this.ScaleDest-this.Scale)/e,this.ScaleKillFlag=i,this.ScalingFlag=!0},UiScore.prototype.setScale=function(t){this.Scale=t,this.entity.setLocalScale(this.Scale,this.Scale,this.Scale)},UiScore.prototype.setShadow=function(t,e,i){this.shadowVec2.x=t,this.shadowVec2.y=e,this.entity.element.shadowOffset=this.shadowVec2,this.entity.element.shadowColor=i},UiScore.prototype.Revive=function(t){this.entity.enabled=!0,this.scoreNum=t,this.setScore(this.scoreNum),this.ScaleMax=3.2,this.setAlpha(.4),this.setScale(.2),this.setFading(1,.2,!1),this.setScaling(this.ScaleMax,.1,!1),this.app.on("score:change",this.setScore,this),this.app.on("game:startintro",this.FadeOut,this)},UiScore.prototype.FadeOut=function(){this.setFading(.5,.3,!1),this.setScaling(.2,.3,!0)},UiScore.prototype.Off=function(){this.entity.enabled=!1,this.app.off("score:change",this.setScore,this),this.app.off("game:startintro",this.FadeOut,this)},UiScore.prototype.setScore=function(t){this.scoreNum=t,this.entity.element.text=this.scoreNum.toString()},UiScore.prototype.update=function(t){if(this.ScalingFlag){if(this.Scale+=this.ScaleSpeed*t,(this.Scale>this.ScaleDest&&this.ScaleSpeed>0||this.Scale<this.ScaleDest&&this.ScaleSpeed<0)&&(this.Scale=this.ScaleDest,this.ScalingFlag=!1,this.ScaleKillFlag))return void this.Off();this.setScale(this.Scale)}if(this.FadeFlag){if(this.Alpha+=this.AlphaSpeed*t,(this.Alpha>this.AlphaDest&&this.AlphaSpeed>0||this.Alpha<this.AlphaDest&&this.AlphaSpeed<0)&&(this.Alpha=this.AlphaDest,this.FadeFlag=!1,this.FadeKillFlag))return void this.Off();this.setAlpha(this.Alpha)}};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.EASE_LINEAR,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this},from:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,n;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,n))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(i,e,n))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,n,s=this.time/this.duration,r=this.easing(s);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],n=this._ev[h],this.target[h]=e+(n-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties)tmp=this._sv[i],this._sv[i]=this._ev[i],this._ev[i]=tmp;this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceIn=function(t){return 1-BounceOut(1-t)},BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,n=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=n*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*.5+1)}}}()),function(){pc.Application.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.on("destroy",(function(){e.stop()})),i&&i.element&&(e.element=i.element),e};var t=pc.Application.getApplication();t&&t.addTweenManager()}();var SkinnedHvost=pc.createScript("hvost");SkinnedHvost.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"Mats"}),SkinnedHvost.attributes.add("ball",{type:"entity",title:"Ball Entity"}),SkinnedHvost.prototype.initialize=function(){this.bones=[],this.bones.push(this.entity.findByName("Bone033")),this.bones.push(this.entity.findByName("Bone034")),this.bones.push(this.entity.findByName("Bone035")),this.bones.push(this.entity.findByName("Bone036")),this.bones.push(this.entity.findByName("Bone037")),this.bones.push(this.entity.findByName("Bone038")),this.bones.push(this.entity.findByName("Bone039")),this.bones.push(this.entity.findByName("Bone040")),this.bones.push(this.entity.findByName("Bone041")),this.bones.push(this.entity.findByName("Bone042")),this.bones.push(this.entity.findByName("Bone043")),this.bones.push(this.entity.findByName("Bone044")),this.bones.push(this.entity.findByName("Bone045")),this.bones.push(this.entity.findByName("Bone046")),this.bones.push(this.entity.findByName("Bone047")),this.bones.push(this.entity.findByName("Bone048")),this.bones.push(this.entity.findByName("Bone049")),this.bones.push(this.entity.findByName("Bone050")),this.bones.push(this.entity.findByName("Bone051")),this.bones.push(this.entity.findByName("Bone052")),this.BonesNum=this.bones.length;var t=this.entity.model.meshInstances[0].aabb.getMin(),s=this.entity.model.meshInstances[0].aabb.getMax();this.DistBone=(s.y-t.y)/this.BonesNum,this.Z_add=.5*-this.DistBone,this.AngMax=5,this.Traces=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.app.on("ball:collide",(function(){this.entity.enabled=!1}),this),this.setColor(0)},SkinnedHvost.prototype.setColor=function(t){this.Color=t,this.entity.model.meshInstances[0].material=this.materials[this.Color].resource},SkinnedHvost.prototype.setMaterial=function(t){this.entity.model.meshInstances[0].material=t.resource},SkinnedHvost.prototype.postInitialize=function(){this.Angle=this.ball.script.ball.RotAngle,this.CosAng=this.ball.script.ball.CosRot,this.SinAng=this.ball.script.ball.SinRot,this.RadBall=.96*this.ball.script.ball.Rad,this.BallPos=this.ball.getPosition(),this.bones[0].setPosition(this.BallPos.x,this.BallPos.y,this.BallPos.z+this.Z_add),this.bones[0].setEulerAngles(this.Angle-270,-90,-90);for(var t=1;t<this.bones.length;t++)this.bones[t].setLocalEulerAngles(0,0,0)},SkinnedHvost.prototype.setVisible=function(t){this.entity.model.meshInstances[0].visible=t},SkinnedHvost.prototype.Revive=function(){this.enabled=!0,this.Angle=this.ball.script.ball.RotAngle,this.CosAng=this.ball.script.ball.CosRot,this.SinAng=this.ball.script.ball.SinRot,this.RadBall=.96*this.ball.script.ball.Rad,this.BallPos=this.ball.getPosition(),this.bones[0].setPosition(this.BallPos.x,this.BallPos.y,this.BallPos.z),this.bones[0].setEulerAngles(this.Angle-270,-90,-90);for(var t=1;t<this.bones.length;t++)this.bones[t].setLocalEulerAngles(0,0,0)},SkinnedHvost.prototype.update=function(t){if(0!==Game.instance.slomo&&(this.Angle=this.ball.script.ball.RotAngle,this.CosAng=this.ball.script.ball.CosRot,this.SinAng=this.ball.script.ball.SinRot,this.BallPos=this.ball.getPosition(),this.bones[0].setPosition(this.BallPos.x+this.CosAng*this.RadBall,this.BallPos.y+this.SinAng*this.RadBall,this.BallPos.z+this.Z_add),this.bones[0].setEulerAngles(this.Angle-270,-90,-90),this.ball.script.ball.getTraces(this.Traces,this.DistBone,this.BonesNum)))for(var s=0,i=0;i<this.BonesNum-1;i++){var e=this.Traces[i+1]-this.Traces[i];Math.abs(e)>360-Math.abs(e)&&(e>0?e=-(360-e):e+=360),Math.abs(e)>this.AngMax&&(e=e<0?-this.AngMax:this.AngMax),s+=e,this.bones[i+1].setLocalEulerAngles(.5*s,1*Math.abs(e)/this.AngMax,e)}};var Slider=pc.createScript("slider");Slider.prototype.initialize=function(){this.X0=this.entity.getPosition().x,this.X=this.entity.getPosition().x,this.Y=this.entity.getPosition().y,this.Z=this.entity.getPosition().z,this.X1=Math.abs(this.X0),this.tweenAlpha=null,this.tweenMove=null,this.app.on("game:startgame",this.Off,this)},Slider.prototype.Revive=function(){if(this.bar=this.app.root.findByName("spriteSlideBar"),this.bar){this.entity.enabled=!0,this.bar.enabled=!0,this.entity.setLocalPosition(this.X0,this.Y,this.Z),this.tweenMove=null,this.entity.sprite.opacity=0,this.bar.sprite.opacity=0;var t={alpha:1},e=this;this.tweenAlpha=this.entity.tween(t).to({alpha:1},1,pc.Linear),this.tweenAlpha.on("update",(function(i){e.entity.sprite.opacity=t.alpha,e.bar.sprite.opacity=.5*t.alpha})),this.tweenAlpha.on("complete",(function(){e.setTweenMove(),e.tweenAlpha=null})),this.tweenAlpha.start()}},Slider.prototype.setTweenMove=function(){this.tweenMove=this.entity.tween(this.entity.getLocalPosition()).to({x:this.X1},1.7,pc.CubicInOut).delay(.7).yoyo(!0).loop(!0).start()},Slider.prototype.Off=function(){null!==this.tweenAlpha&&this.tweenAlpha.stop(),null!==this.tweenMove&&this.tweenMove.stop(),this.bar.enabled=!1,this.entity.enabled=!1},Slider.prototype.update=function(t){};var PopText=pc.createScript("popText");PopText.prototype.initialize=function(){this.shadowVec2=new pc.Vec2(0,0),this.PosVec=new pc.Vec3(0,0,0),this.Scale0=.01,this.tweenScale=null,this.tweenStage=0},PopText.prototype.Create=function(e,t,s,i,a,c,n,l,h){this.entity.setPosition(e,t,s),this.entity.setLocalEulerAngles(0,0,c),this.ScaleMax=n*this.Scale0,this.Scale=.1*this.Scale0,this.entity.setLocalScale(this.Scale,this.Scale,this.Scale),this.entity.element.text=i,this.entity.element.color=a,this.entity.element.opacity=l,this.shadowVec2.x=0,this.shadowVec2.y=0,this.entity.element.shadowOffset=this.shadowVec2,this.tweenStage=0,this.Pause=h;var o={scale:.1},S=this;this.tweenScale=this.entity.tween(o).to({scale:1},.3,pc.BackIn),this.tweenScale.on("update",(function(e){S.Scale=o.scale*S.ScaleMax,S.entity.setLocalScale(S.Scale,S.Scale,S.Scale)})),this.tweenScale.on("complete",(function(){0===S.tweenStage?(S.tweenStage=1,S.tweenScale.to({scale:.1},.3,pc.BackIn).delay(S.Pause),S.tweenScale.start()):S.Off()})),this.tweenScale.start()},PopText.prototype.setShadow=function(e,t,s){this.shadowVec2.x=e,this.shadowVec2.y=t,this.entity.element.shadowOffset=this.shadowVec2,this.entity.element.shadowColor=s},PopText.prototype.Create2=function(e,t,s,i,a,c,n){this.entity.getLocalPosition(this.PosVec),this.PosVec.y=e,this.entity.setLocalPosition(this.PosVec),this.Scale0=1,this.entity.enabled=!0,this.entity.setLocalEulerAngles(0,0,i),this.ScaleMax=a*this.Scale0,this.Scale=.1*this.Scale0,this.entity.setLocalScale(this.Scale,this.Scale,this.Scale),this.entity.element.text=t,this.entity.element.color=s,this.entity.element.opacity=c,this.shadowVec2.x=0,this.shadowVec2.y=0,this.entity.element.shadowOffset=this.shadowVec2,this.tweenStage=0,this.Pause=n;var l={scale:.1},h=this;this.tweenScale=this.entity.tween(l).to({scale:1},.3,pc.BackIn),this.tweenScale.on("update",(function(e){h.Scale=l.scale*h.ScaleMax,h.entity.setLocalScale(h.Scale,h.Scale,h.Scale)})),this.tweenScale.on("complete",(function(){0===h.tweenStage?(h.tweenStage=1,h.tweenScale.to({scale:.1},.3,pc.BackIn).delay(h.Pause),h.tweenScale.start()):h.Off()})),this.tweenScale.start(),this.entity.enabled=!0},PopText.prototype.Off=function(){this.entity.enabled=!1};var Ring=pc.createScript("ring");Ring.prototype.initialize=function(){this.Chunks=[],this.ChunksNum=0,this.Z_tokill=0,this.AngleToBallMin=180,this.BallCollParams={ang:0,circ:null},this.CollParams=[],this.CollParamsNum=0,this.CollBlock={xy:[],num:0},this.app.on("game:stop",(function(){this.entity.enabled&&this.Stop()}),this),this.ActiveFlag=!1},Ring.prototype.Create=function(t,i,s,h){this.X=t,this.Y=i,this.Z=s,this.ball=h,this.Z_ball=this.ball.getPosition().z,this.RadBall=this.ball.script.ball.Rad,this.BallAngColl=this.ball.script.ball.AngSpanColl,this.ChunksNum=0,this.Span=0,this.Color=0,this.DisappearFlag=!1,this.RunFlag=!0,this.CollParamsNum=0,this.BallHitCntr=1,this.entity.setPosition(this.X,this.Y,this.Z),this.ActiveFlag=!0},Ring.prototype.getCollParams=function(t){return void 0===this.CollParams[t]&&(this.CollParams[t]={ang:0,circ:null}),this.CollParams[t].ang=180,this.CollParams[t]},Ring.prototype.setColor=function(t){this.Color=t},Ring.prototype.OnChunksAdded=function(){for(var t=0;t<this.ChunksNum;t++)this.Chunks[t].script.chunk.OnCircsAdded()},Ring.prototype.checkParents=function(){for(var t=0,i=0;i<this.ChunksNum;i++)t+=this.Chunks[i].script.chunk.checkParents();return t},Ring.prototype.addChunk=function(t){this.Chunks[this.ChunksNum]=t,this.ChunksNum++,t.script.chunk.Span>this.Span&&(this.Span=t.script.chunk.Span),this.Z_tokill=this.Span/2},Ring.prototype.setDisappear=function(){for(var t=0;t<this.ChunksNum;t++)this.Chunks[t].script.chunk.setDisappear();this.DisappearFlag=!0},Ring.prototype.OnBallCollide=function(){this.Off()},Ring.prototype.setRun=function(t){this.RunFlag=t},Ring.prototype.Stop=function(){if(this.RunFlag){for(var t=0;t<this.ChunksNum;t++)this.Chunks[t].script.chunk.Stop();this.RunFlag=!1}},Ring.prototype.Off=function(){if(this.ActiveFlag){for(var t=0;t<this.ChunksNum;t++)this.Chunks[t].script.chunk.Off();this.ChunksNum=0,this.RunFlag=!1,this.entity.enabled=!1,this.ActiveFlag=!1}},Ring.prototype.update=function(t){if(this.RunFlag){var i=this.app.speedGame*t*Game.instance.slomo;this.Z+=i,this.entity.setPosition(this.X,this.Y,this.Z);for(var s=0;s<this.ChunksNum;s++)this.Chunks[s].script.chunk.setZ(this.Z,t);if(!(this.Z<this.Z_ball-i-this.Span/2-.5)){if(this.Z_tocheck=this.Z_ball-this.RadBall-this.Span/2,this.Z_notcheck=this.Z_ball+this.RadBall+this.Span/2+i,this.Z>=this.Z_tocheck&&this.Z<=this.Z_notcheck){var h,l=!1;for(s=0;s<this.ChunksNum;s++)h=this.getCollParams(s),this.Chunks[s].enabled&&this.Chunks[s].script.chunk.checkOnBall(this.ball.script.ball.RotAngle,this.BallAngColl,h)&&(l=!0);if(l){var a=-1;for(s=0;s<this.ChunksNum;s++)this.CollParams[s].ang<0&&(a<0||this.CollParams[s].ang<this.CollParams[a].ang)&&(a=s);if(a>=0){if(this.BallHitCntr++,this.CollParams[a].circ.Color===this.ball.script.ball.Color){var n=!1;return null!==this.CollParams[a].star&&this.CollParams[a].angStar<0&&(n=!0),this.CollParams[a].circ.fillBlockXYs(this.CollBlock),this.app.fire("ball:color",this.CollBlock,this.CollParams[a].circ,n,this.Color,this),void this.OnBallCollide()}return this.app.fire("ball:collide",this.CollParams[a].circ,this.CollParams[a].circ.Color,this.CollParams[a].centFlag),void(this.RunFlag=!1)}}}this.DisappearFlag||this.Z>=this.Z_notcheck&&(0===this.BallHitCntr&&this.app.fire("game:circlepassed"),this.DisappearFlag=!0),this.Z>this.Z_tokill&&this.Off()}}};var Star=pc.createScript("star");Star.attributes.add("type",{type:"number",default:0}),Star.attributes.add("AngSpan",{type:"number",default:7}),Star.prototype.initialize=function(){this.Xc=0,this.Yc=0,this.Z=0,this.AngSpanHalf=this.AngSpan/2},Star.prototype.Create=function(t,i,s,h){this.Xc=0,this.Yc=0,this.Z=i,this.RadRot0=h,this.RadRot=h,this.Angle0=s,this.Angle0<0&&(this.Angle0+=360),this.Angle0>360&&(this.Angle0-=360),this.CosRot=Math.cos(Math.PI*this.Angle0/180),this.SinRot=Math.sin(Math.PI*this.Angle0/180),this.X=this.Xc+this.CosRot*this.RadRot,this.Y=this.Yc+this.SinRot*this.RadRot,this.entity.setLocalPosition(this.X,this.Y,this.Z),this.entity.setLocalEulerAngles(0,0,this.Angle0),this.setScale(1),this.RotFlag=!1,this.RunFlag=!0,this.entity.enabled=!0},Star.prototype.getZ=function(){return this.entity.getPosition().z},Star.prototype.setRadRot=function(t){this.RadRot=t,this.X=this.Xc+this.CosRot*this.RadRot,this.Y=this.Yc+this.SinRot*this.RadRot,this.entity.setLocalPosition(this.X,this.Y,this.Z)},Star.prototype.setRadCoeff=function(t){this.RadRot=this.RadRot0*t,this.X=this.Xc+this.CosRot*this.RadRot,this.Y=this.Yc+this.SinRot*this.RadRot,this.entity.setLocalPosition(this.X,this.Y,this.Z)},Star.prototype.getMinAngleToBall=function(t,i,s){},Star.prototype.getMinAngle=function(t,i,s){var h=Math.abs(t-(this.Angle0+s));return h>360&&(h-=360),h>360&&(h-=360),h>360-h&&(h=360-h),h-(i+this.AngSpanHalf)},Star.prototype.setScale=function(t){this.Scale=t,this.entity.setLocalScale(this.Scale,this.Scale,this.Scale)},Star.prototype.Off=function(){this.entity.enabled=!1};var BitPart=pc.createScript("bitPart");BitPart.prototype.initialize=function(){this.Pos=new pc.Vec3},BitPart.prototype.Create=function(t,i,e,s,h,a,o,n,p,r=1,c=1){this.fadeSpeed=c,this.Pos.z=e,this.Pos.x=t,this.Pos.y=i,this.entity.setPosition(this.Pos),this.Type=s;Math.random();this.speedy=p*Math.sin(n),this.speedx=p*Math.cos(n),this.TimeCntr=o,this.angZ=180*Math.random(),this.entity.setLocalEulerAngles(0,0,this.angZ),this.angSpeedZ=25+90*Math.random(),Math.random()>.5&&(this.angSpeedZ=-this.angSpeedZ),this.Scale=a,this.entity.setLocalScale(this.Scale,this.Scale,this.Scale),this.ScaleSpeed=this.Scale/.2*r,this.entity.sprite.color=h,this.entity.sprite.color.a=1,this.Coeff=1,this.CoeffSpeed=2,this.FadeFlag=!1},BitPart.prototype.setColor=function(t){this.entity.sprite.color=t},BitPart.prototype.update=function(t){if((this.TimeCntr-=t)<0){if(this.Scale-=this.ScaleSpeed*t,this.Scale<=0)return void(this.entity.enabled=!1);this.entity.setLocalScale(this.Scale,this.Scale,this.Scale)}if(this.entity.sprite.opacity-=this.fadeSpeed*t,this.entity.sprite.opacity<=0)return this.entity.sprite.opacity=0,void(this.entity.enabled=!1);this.Pos.x+=this.speedx*t,this.Pos.y+=this.speedy*t,this.Coeff-=this.CoeffSpeed*t,this.Coeff<.3&&(this.Coeff=.3),this.entity.setPosition(this.Pos),this.angZ+=this.angSpeedZ*t,this.entity.setLocalEulerAngles(0,0,this.angZ)};var Glow=pc.createScript("glow");Glow.prototype.initialize=function(){},Glow.prototype.Create=function(o,t,e,p,i,n,r,c,l,a){},Glow.prototype.update=function(o){};var GlowCirc=pc.createScript("glowCirc");GlowCirc.prototype.initialize=function(){this.tweenScale=null},GlowCirc.prototype.Create=function(t,e,i,a,c,l,n){this.entity.setPosition(t,e,i),this.ScaleMax=1.5*a,this.Scale=n*a,this.entity.setLocalScale(this.Scale,this.Scale,this.Scale),this.Alpha=1,this.entity.sprite.opacity=this.Alpha,this.entity.sprite.color=c;var s={scale:n*a,alpha:1},o=this;this.tweenScale=this.entity.tween(s).to({scale:1.5,alpha:0},l,pc.QuadraticOut),this.tweenScale.on("update",(function(t){o.Scale=s.scale*o.ScaleMax,o.Alpha=s.alpha,o.entity.sprite.opacity=o.Alpha,o.entity.setLocalScale(o.Scale,o.Scale,o.Scale)})),this.tweenScale.on("complete",(function(){o.Off()})),this.tweenScale.start()},GlowCirc.prototype.Off=function(){this.entity.enabled=!1};var PartStar=pc.createScript("partStar");PartStar.prototype.initialize=function(){this.Pos=new pc.Vec3},PartStar.prototype.Create=function(t,e,i,s,a,h,n,o){this.Pos.x=t,this.Pos.y=e,this.Pos.z=i,this.entity.setPosition(this.Pos),this.Type=s,this.TimeCntr=n,this.angZ=180*Math.random(),this.entity.setLocalEulerAngles(0,0,this.angZ),this.angSpeedZ=45+45*Math.random(),Math.random()>.5&&(this.angSpeedZ=-this.angSpeedZ),this.Scale=h,this.entity.setLocalScale(this.Scale,this.Scale,this.Scale),this.ScaleSpeed=this.Scale/.12,this.entity.sprite.color=a,this.Speed=o,this.FadeFlag=!1,this.entity.enabled=!0},PartStar.prototype.update=function(t){if((this.TimeCntr-=t)<0){if(this.Scale-=this.ScaleSpeed*t,this.Scale<=0)return void(this.entity.enabled=!1);this.entity.setLocalScale(this.Scale,this.Scale,this.Scale)}this.Pos.z+=this.Speed*t,this.entity.setPosition(this.Pos),this.angZ+=this.angSpeedZ*t,this.entity.setLocalEulerAngles(0,0,this.angZ)};var PopShade=pc.createScript("popShade");PopShade.prototype.initialize=function(){this.tweenScale=null,this.PosVec=new pc.Vec3(0,0,0)},PopShade.prototype.Create2=function(e,t,a,i,c,s,n){this.entity.getLocalPosition(this.PosVec),this.PosVec.y=e,this.entity.setLocalPosition(this.PosVec),this.Scale0=1,this.entity.enabled=!0,this.entity.setLocalEulerAngles(0,0,a),this.ScaleMax=i*this.Scale0,this.Scale=.1*this.Scale0,this.Aspect=c,this.entity.setLocalScale(this.Scale*this.Aspect,this.Scale,this.Scale),this.entity.element.color=t,this.entity.element.opacity=s,this.tweenStage=0,this.Pause=n;var l={scale:.1},o=this;this.tweenScale=this.entity.tween(l).to({scale:1},.3,pc.BackIn),this.tweenScale.on("update",(function(e){o.Scale=l.scale*o.ScaleMax,o.entity.setLocalScale(o.Scale*o.Aspect,o.Scale,o.Scale)})),this.tweenScale.on("complete",(function(){0===o.tweenStage?(o.tweenStage=1,o.tweenScale.to({scale:.1},.3,pc.BackIn).delay(o.Pause),o.tweenScale.start()):o.Off()})),this.tweenScale.start()},PopShade.prototype.Off=function(){this.entity.enabled=!1};var UiScoreScale=pc.createScript("uiScoreScale");UiScoreScale.prototype.initialize=function(){},UiScoreScale.prototype.setResolution=function(){window.console.log("width:  "+window.screen.width),window.console.log("height:  "+window.screen.height)};var StarsZig=pc.createScript("starsZig");StarsZig.prototype.initialize=function(){this.Stars=[],this.StarsNum=0,this.X=0,this.Y=0,this.RotAngle=0},StarsZig.prototype.setParams=function(t,i){this.matStars=t,this.matGlows=i},StarsZig.prototype.Create=function(t,i,a,s,r,e,h,n,l,o){this.X=0,this.Z=0,this.Z=t,this.entity.enabled=!0,this.Stars=[],this.Glows=[],this.starPapa=e,this.glowPapa=h,this.ball=l,this.Z_ball=this.ball.getPosition().z,this.RadBall=this.ball.script.ball.Rad,this.BallAngColl=this.ball.script.ball.AngSpanColl,this.Color=o,this.Rad=i,this.entity.setPosition(0,0,this.Z),this.FirstStar=null,this.StarsNum=0,this.StarCheckIndex=0,this.StarKillIndex=0,this.Score=n,this.EndedFlag=!1,angStepDir=0,angDirSteps=0,angDirVel=0,angDirSteps=10,angStepDir=(angStepDir=Math.random(1))>.5?1:-1,angStepDir*=15,this.DistMax=a,this.Dist=0,a<1?this.addStars(s,r,45*Math.round(pc.math.random(1,8))):this.addStars(s,r,-90)},StarsZig.prototype.Off=function(){this.entity.enabled=!1};var angStepDir=0,angDirSteps=0,angDirVel=0;StarsZig.prototype.addStars=function(t,i,a){for(var s=a,r=0,e=0,h=.015/Main.GAMESPEED,n=.16/Main.GAMESPEED;e<this.DistMax;)this.addStar(r,s,h),angStepDir>0?(angDirVel+=3)>angStepDir&&(angStepDir=-pc.math.random(15,22)):(angDirVel+=-3)<angStepDir&&(angStepDir=pc.math.random(15,22)),(s+=1.8*angDirVel)>360&&(s-=360),e+=t,r-=t,h+=n},StarsZig.addStar2=function(t,i,a){chunk=new pc.Entity,chunk.addComponent("script"),chunk.script.create("starZig",{attributes:{type:0}}),star=Main.instance.starZZ.clone(),star.enabled=!0,chunk.script.starZig.addStar(star),glow=Main.instance.glowZZ.clone(),glow.enabled=!0,chunk.script.starZig.addGlow(glow),chunk.addChild(glow),chunk.enabled=!0,chunk.script.starZig.Create(t,i,1,0,(new pc.Color).fromString("#f235da"),a),Main.instance.app.root.addChild(chunk)},StarsZig.prototype.addStar=function(t,i,a){var s=this.Stars[this.StarsNum];void 0===this.Stars[this.StarsNum]&&((s=new pc.Entity).addComponent("script"),s.script.create("starZig",{attributes:{type:0}}),this.entity.addChild(s),this.Stars[this.StarsNum]=s,star=this.starPapa.clone(),star.enabled=!0,s.script.starZig.addStar(star),glow=this.glowPapa.clone(),glow.enabled=!0,s.script.starZig.addGlow(glow),this.entity.addChild(glow)),s.enabled=!0,s.script.starZig.Create(t,i,this.Rad,0,this.Color,a),s.script.starZig.setColors(this.matStars[this.Color].resource,this.matGlows[this.Color]),this.StarsNum++},StarsZig.prototype.update=function(t){var i=this.app.speedGame*t*Game.instance.slomo;this.StarCheckIndex<this.StarsNum?this.Z+this.Stars[this.StarCheckIndex].script.starZig.Z>=this.Z_ball-this.Stars[this.StarCheckIndex].script.starZig.SpanRad-this.RadBall&&(this.Stars[this.StarCheckIndex].script.starZig.getMinAngle(this.ball.script.ball.RotAngle,this.BallAngColl,this.RotAngle)<0&&(this.app.fire("ball:star",this.Stars[this.StarCheckIndex].script.starZig,this.Score),this.Stars[this.StarCheckIndex].script.starZig.Off()),this.StarCheckIndex++):(this.EndedFlag||(this.DistMax<1?this.app.fire("game:stopzig",!0):this.app.fire("game:stopzig",!1)),this.EndedFlag=!0),this.StarKillIndex<this.StarsNum?this.Z+this.Stars[this.StarKillIndex].script.starZig.Z>0&&(this.Stars[this.StarKillIndex].script.starZig.Off(),this.StarKillIndex++):this.Off(),Main.instance.gameState!==GAME_GAMEOVER&&(this.Z+=i),this.entity.setPosition(this.X,this.Y,this.Z)};var StarZig=pc.createScript("starZig");StarZig.prototype.initialize=function(){this.Xc=0,this.Yc=0,this.Z=0,this.type=0,this.AngSpan=19,this.RotSpeed=90,this.ScaleMax=1,this.TimeScale=.3,this.AngSpanHalf=this.AngSpan/2},StarZig.prototype.Create=function(t,i,s,e,h,a){this.Xc=0,this.Yc=0,this.Z=t,this.RadRot0=s,this.RadRot=s,this.Color=h,this.Glow.enabled=!0,this.RotAng=e,this.Angle0=i,this.Angle0<0&&(this.Angle0+=360),this.Angle0>360&&(this.Angle0-=360),this.CosRot=Math.cos(Math.PI*this.Angle0/180),this.SinRot=Math.sin(Math.PI*this.Angle0/180),this.X=this.Xc+this.CosRot*this.RadRot,this.Y=this.Yc+this.SinRot*this.RadRot,this.entity.setLocalPosition(this.X,this.Y,this.Z),this.entity.setLocalEulerAngles(0,this.RotAng,0),this.ScaleCoeff=.5,this.ScaleGlowCoeffX=.5,this.ScaleGlowCoeffY=.9,this.Glow.setLocalPosition(this.X,this.Y,this.Z),this.Glow.sprite.opacity=0,this.setScale(0),this.RotFlag=!0,this.ScalingFlag=!1,this.setScaling(this.ScaleMax,this.TimeScale,a),this.RunFlag=!0,this.Star.enabled=!0,this.entity.enabled=!0},StarZig.prototype.setScaling=function(t,i,s){this.ScaleDest=t,this.ScaleSpeed=(this.ScaleDest-this.Scale)/i*2,this.ScaleDelay=s,this.ScalingFlag=!0},StarZig.prototype.addGlow=function(t){this.Glow=t},StarZig.prototype.addStar=function(t){this.Star=t,this.entity.addChild(t);var i=t.model.meshInstances[0].aabb.getMin(),s=t.model.meshInstances[0].aabb.getMax(),e=(s.x,i.x,(s.y-i.y)/2);s.z,i.z;this.SpanRad=e,this.Star.setLocalPosition(0,0,0),this.Star.setLocalEulerAngles(0,0,0)},StarZig.prototype.getZ=function(){return this.entity.getPosition().z},StarZig.prototype.setRadRot=function(t){this.RadRot=t,this.X=this.Xc+this.CosRot*this.RadRot,this.Y=this.Yc+this.SinRot*this.RadRot,this.entity.setLocalPosition(this.X,this.Y,this.Z)},StarZig.prototype.setRadCoeff=function(t){this.RadRot=this.RadRot0*t,this.X=this.Xc+this.CosRot*this.RadRot,this.Y=this.Yc+this.SinRot*this.RadRot,this.entity.setLocalPosition(this.X,this.Y,this.Z)},StarZig.prototype.getMinAngle=function(t,i,s){var e=Math.abs(t-(this.Angle0+s));return e>360&&(e-=360),e>360&&(e-=360),e>360-e&&(e=360-e),e-(i+this.AngSpanHalf)},StarZig.prototype.setColors=function(t,i){this.Star.model.meshInstances[0].material=t,this.Glow.sprite.color=i},StarZig.prototype.setScale=function(t){this.Scale=t,this.entity.setLocalScale(this.Scale*this.ScaleCoeff,this.Scale*this.ScaleCoeff,this.Scale*this.ScaleCoeff),this.Glow.setLocalScale(this.Scale*this.ScaleGlowCoeffX,this.Scale*this.ScaleGlowCoeffY,this.Scale)},StarZig.prototype.Off=function(){this.Star.enabled=!1,this.entity.enabled=!1,this.Glow.enabled=!1},StarZig.prototype.update=function(t){this.RotAng+=this.RotSpeed*t,this.RotAng>360&&(this.RotAng-=360),this.entity.setLocalEulerAngles(0,this.RotAng,0),this.ScalingFlag&&(this.ScaleDelay-=t,this.ScaleDelay<0&&(this.Scale+=this.ScaleSpeed*t,this.Scale>=this.ScaleDest&&(this.Scale=this.ScaleDest,this.ScalingFlag=!1),this.setScale(this.Scale)))};var BgFader=pc.createScript("bgFader");BgFader.prototype.initialize=function(){this.FadeFlag=!1},BgFader.prototype.Create=function(t){this.Alpha=0,this.entity.element.opacity=this.Alpha,this.setFade(1,t)},BgFader.prototype.setFade=function(t,e){this.AlphaDest=t,this.FadeSpeed=(this.AlphaDest-this.Alpha)/e,this.FadeFlag=!0},BgFader.prototype.FadeOut=function(t){this.entity.enabled&&this.setFade(0,t)},BgFader.prototype.update=function(t){this.FadeFlag&&(this.Alpha+=this.FadeSpeed*t,this.FadeSpeed>0&&this.Alpha>1&&(this.Alpha=1,this.FadeFlag=!1),this.FadeSpeed<0&&this.Alpha<=0&&(this.Alpha=0,this.FadeFlag=!1,this.entity.enabled=!1,this.FadeFlag=!1),this.entity.element.opacity=this.Alpha)};var FullscreenImage=pc.createScript("fullscreenImage");FullscreenImage.getScreenComponentIteration=0,FullscreenImage.getScreenComponent=function(e){return FullscreenImage.getScreenComponentIteration++,FullscreenImage.getScreenComponentIteration>10?null:e.screen?e.screen:FullscreenImage.getScreenComponent(e.parent)},FullscreenImage.prototype.initialize=function(){FullscreenImage.getScreenComponentIteration=0,this.screenComponent=FullscreenImage.getScreenComponent(this.entity),this.updateSize(),window.addEventListener("resize",this.updateSize.bind(this))},FullscreenImage.prototype.updateSize=function(){var e=this.screenComponent.referenceResolution,n=this.screenComponent.scaleBlend,t=window.innerWidth,r=window.innerHeight;this.entity.element.width=pc.math.lerp(e.x,t/r*e.y,n),this.entity.element.height=pc.math.lerp(e.x*r/t,e.y,n)};var Input=pc.createScript("input");function js_isIE(){var o=window.navigator.userAgent;return/MSIE|Trident/.test(o)}function js_isMobileOrTablet(){var o,t=!1;o=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(o)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(o.substr(0,4)))&&(t=!0);var e=navigator.maxTouchPoints||"ontouchstart"in document.documentElement,n=void 0!==window.orientation;return t||(e||n)}Input.prevMouseX=0,Input.prevMouseY=0,Input.mouseDown=!1,Input.mouseDownPrev=!1,Input.mouseX=0,Input.mouseY=0,Input.mousePressed=!1,Input.prototype.postUpdate=function(o){Input.mousePressed=!1},Input.prototype.update=function(o){if(!1===Input.mouseDown&&!0===Input.mouseDownPrev&&(Input.mousePressed=!0,this.app.fire("input:mousepress")),!0===Input.mouseDown&&!0===Input.mouseDownPrev&&(Input.mouseX!=Input.prevMouseX||Input.mouseY!=Input.prevMouseY)){var t=Input.mouseX-Input.prevMouseX,e=Input.mouseY-Input.prevMouseY;this.app.fire("input:mouseswipe",t,e,o)}Input.prevMouseX=Input.mouseX,Input.prevMouseY=Input.mouseY,Input.mouseDownPrev=Input.mouseDown},Input.prototype.initialize=function(){this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHEND,this._onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHSTART,this._onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this._onTouchMove,this)),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this._onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this._onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this._onMouseMove,this)},Input.prototype._onTouchMove=function(o){var t=o.changedTouches[0];o.event.preventDefault(),Input.mouseX=t.x,Input.mouseY=t.y},Input.prototype._onTouchStart=function(o){var t=o.changedTouches[0];o.event.preventDefault(),Input.mouseX=t.x,Input.mouseY=t.y,Input.mouseDown=!0},Input.prototype._onTouchEnd=function(o){var t=o.changedTouches[0];o.event.preventDefault(),Input.mouseX=t.x,Input.mouseY=t.y,Input.mouseDown=!1},Input.prototype._onMouseMove=function(o){Input.mouseX=o.x,Input.mouseY=o.y},Input.prototype._onMouseDown=function(o){Input.mouseX=o.x,Input.mouseY=o.y,Input.mouseDown=!0},Input.prototype._onMouseUp=function(o){Input.mouseX=o.x,Input.mouseY=o.y,Input.mouseDown=!1};var MyButton=pc.createScript("myButton");MyButton.attributes.add("startScale",{type:"number",default:1}),MyButton.attributes.add("animScaleKoef",{type:"number",default:.2}),MyButton.attributes.add("actionName",{type:"string",default:"type name of action"}),MyButton.setClickable=function(e,t){for(var n,a=0;a<e.children.length;a++)(n=e.children[a]).script&&n.script.myButton&&(n.script.myButton.clickable=t),MyButton.setClickable(n,t)},MyButton.prototype.onClick=function(){switch(this.actionName){case"firstAudio":GameAudio.play("button"),this.entity.enabled=!1;break;case"pauseHome":Uipopup.close("Pause"),js_GS_gameOver(),setTimeout((function(){Game.instance.slomo=1,Main.instance.AllowGameInputFlag=!0}),600),FadeScreen.instance.show(.5,0,0,(function(){Main.instance.setIntro(),Main.instance.AllowGameInputFlag=!0,Game.instance.slomo=1,Game.instance.gameOver.enabled=!1}));break;case"resumeGame":Game.instance.interface.enabled=!0,setTimeout((function(){if(Uipopup.isShown("Pause"))return 1;console.log("window focused"),Game.instance.slomo=1,Main.instance.AllowGameInputFlag=!0}),600),Uipopup.close("Pause");break;case"pauseGame":Game.instance.interface.enabled=!1,Game.instance.slomo=0,Uipopup.open("Pause",!0);break;case"openTutor":MyButton.setClickable(Game.instance.gameOver,!1),Main.instance.AllowGameInputFlag=!1,Game.instance.startGameButtonEnabled=!1,MyButton.setClickable(Game.instance.mainMenu,!1),Uipopup.open("Tutorial",!0);break;case"closeTutor":MyButton.setClickable(Game.instance.gameOver,!0),MyButton.setClickable(Game.instance.mainMenu,!0),Game.instance.startGameButtonEnabled=!0,Main.instance.gameState==GAME_PLAYING?Uipopup.open("Pause",!0):1===Game.instance.firstLaunch2?(Game.instance.firstLaunch2=0,Uipopup.close("Tutorial"),setTimeout((function(){Game.instance.shop.enabled||(Main.instance.AllowGameInputFlag=!0)}),1e3)):Uipopup.open("Settings",!0);break;case"openSettings":Main.instance.AllowGameInputFlag=!1,MyButton.setClickable(Game.instance.gameOver,!1),Game.instance.startGameButtonEnabled=!1,MyButton.setClickable(Game.instance.mainMenu,!1),Uipopup.open("Settings",!0);break;case"closeSettings":setTimeout((function(){Game.instance.shop.enabled||(Main.instance.AllowGameInputFlag=!0)}),1e3),MyButton.setClickable(Game.instance.gameOver,!0),Game.instance.startGameButtonEnabled=!0,MyButton.setClickable(Game.instance.mainMenu,!0),Uipopup.close("Settings");break;case"shopLeft":ShopController.instance.switchItem(-1);break;case"shopRight":ShopController.instance.switchItem(1);break;case"shopBuy":ShopController.instance.buyItem(ShopController.instance.shownItemId);break;case"shopChoose":FadeScreen.instance.show(.5,0,0,(function(){Game.instance.interface.enabled=!1,Game.instance.mainMenu.enabled=!0,Game.instance.shop.enabled=!1,ShopController.instance.closeShop(),Main.instance.AllowGameInputFlag=!0,ShopController.instance.chooseSkin(ShopController.instance.shownItemId),Main.instance.setIntro(),Game.instance.tutorSlider.enabled=!0}));break;case"shopClose":FadeScreen.instance.show(.5,0,0,(function(){Game.instance.interface.enabled=!1,Game.instance.mainMenu.enabled=!0,Game.instance.shop.enabled=!1,ShopController.instance.closeShop(),Main.instance.AllowGameInputFlag=!0,Game.instance.startGameButtonEnabled=!0,Main.instance.setIntro(),Game.instance.tutorSlider.enabled=!0}));break;case"shopOpen":Main.instance.AllowGameInputFlag=!1,Game.instance.startGameButtonEnabled=!1,FadeScreen.instance.show(.5,0,1,(function(){Game.instance.interface.enabled=!1,Game.instance.mainMenu.enabled=!1,Game.instance.shop.enabled=!0,Game.instance.tutorSlider.enabled=!1}));break;case"pause":MyButton.setClickable(Game.instance.uiInterface,!1),MyButton.setClickable(Game.instance.Screen3D,!1),Game.instance.controlsEnabled=!1,Uipopup.open("pause",!0);break;case"pauseContinue":MyButton.setClickable(Game.instance.uiInterface,!0),MyButton.setClickable(Game.instance.Screen3D,!0),Game.instance.controlsEnabled=!0,Uipopup.close("pause");break;case"pauseRestart":Uipopup.close("pause"),Game.instance._state!=Game.STATE_GAMEOVER&&(Game.instance._state=Game.STATE_GAMEOVER,js_GS_gameOver()),FadeScreen.instance.show(.5,0,0,(function(){Game.instance.flushSavedPlates(),Game.instance.reset(),Game.instance.start()}));break;case"continueScoreButton":FadeScreen.instance.show(.5,0,0,(function(){Main.instance.setIntro(),Main.instance.AllowGameInputFlag=!0,Game.instance.gameOver.enabled=!1}));break;case"levelCompletedClaim":MyButton.setClickable(Game.instance.uiInterface,!0),MyButton.setClickable(Game.instance.Screen3D,!0),Game.instance.controlsEnabled=!0,Game.instance.prepareLevel(Game.instance.levelCurr+1,0),Game.instance.uiLevelCompleted.script.uiLevelCompleted.claim();for(var e=0;e<20;e++)StarEffect.create(1);break;case"gameOverContinue":FadeScreen.instance.show(.5,0,0,(function(){Game.instance.gotoMainMenu()}));break;case"gameUrnPlate":Game.instance.controlsUrn&&Game.instance.urnPlate();break;case"buyhtml5Contact":window.open("mailto:contact@buyhtml5.com");break;case"dagaevdevContact":window.open("mailto:dagaevdev@gmail.com");break;case"mainMenuPlay":FadeScreen.instance.show(.3,.1,!1,(function(){Game.instance.start()}));break;case"mainMenuArcade":FadeScreen.instance.show(.3,.1,!1,(function(){Game.instance.start(Game.GAMEMODE_CLASSIC)}));break;case"musicButton":GameAudio.switchMusic(!GameAudio.muteMus);break;case"soundButton":GameAudio.switch(!GameAudio.mute);break;case"musicButton":GameAudio.switchMusic(!GameAudio.muteMus);break;case"backButtonInShop":ShopController.applySkin(Game.instance.ballModel,Game.instance.chosenSkinId),ShopController.instance.closeShop();break;case"leftButtonInShop":ShopController.instance.switchItem(-1);break;case"rightButtonInShop":ShopController.instance.switchItem(1);break;case"chooseButtonInShop":Game.instance.chosenSkinId=ShopController.instance.shownItemId,ShopController.applySkin(Game.instance.ballModel,Game.instance.chosenSkinId),ShopController.instance.closeShop();break;case"unlockButtonInShop":GameAudio.play("buyitem"),ShopController.instance.buyItem(ShopController.instance.shownItemId);break;case"continueButtonInScore":FadeScreen.instance.show(.5,.1,!1,(function(){this.app.fire("game:makereset",!1)}));break;case"shopButtonInScore":FadeScreen.instance.show(.3,.1,!1,(function(){Game.instance.uiShop.enabled=!0,Game.instance.uiScore.enabled=!1}));break;case"restartButtonInScore":FadeScreen.instance.show(.5,.1,!1,(function(){this.app.fire("game:makereset",!0)}));break;default:return 0}},MyButton.prototype.initialize=function(){this.button=this.entity.button,this.clickable=!0,this.animScaling=!0,this.mouseDown=!1,this.pressScaleX=1,this.pressScaleY=1,this.pressScaleXVel=0,this.entity.element.on("mousedown",this.onMouseDown,this),this.entity.element.on("mouseleave",this.onMouseLeave,this),this.entity.element.on("mouseup",this.onMouseLeave,this),this.entity.element.on("touchstart",this.onMouseDown,this),this.entity.element.on("touchend",this.onMouseLeave,this)},MyButton.prototype.onMouseDown=function(){if(FadeScreen.instance.fading)return 1;this.clickable&&(GameAudio.play("button"),MyButton.justPressed=!0,this.mouseDown=!0,this.onClick())},MyButton.prototype.onMouseLeave=function(){this.mouseDown=!1},MyButton.prototype.postUpdate=function(e){MyButton.justPressed=!1},MyButton.prototype.update=function(e){this.animScaling?(this.mouseDown?(this.pressScaleX>1-this.animScaleKoef&&(this.pressScaleX=pc.math.lerp(this.pressScaleX,1-this.animScaleKoef,.5)),this.pressScaleY=this.pressScaleX):(this.pressScaleXVel+=20*(1-this.pressScaleX),this.pressScaleXVel*=.7,this.pressScaleX+=this.pressScaleXVel*e,this.pressScaleY=this.pressScaleX),this.entity.setLocalScale(this.pressScaleX*this.startScale,this.pressScaleY*this.startScale,1)):this.entity.setLocalScale(this.startScale,this.startScale,this.startScale)},MyButton.setClickable=function(e,t){for(var n,a=0;a<e.children.length;a++)(n=e.children[a]).script&&n.script.myButton&&(n.script.myButton.clickable=t),MyButton.setClickable(n,t)};var FadeScreen=pc.createScript("fadeScreen");FadeScreen.attributes.add("fadeScreenImage",{type:"entity"}),FadeScreen.instance=null,FadeScreen.prototype.initialize=function(){FadeScreen.instance=this,this.fadeTime=1,this.delay=0,this.onlyFadeOut=!1,this.action=null,this.time=0,this.fading=!1,this.state=0,this.fadeScreenImage.element.opacity=0,FadeScreen.instance.show(.9,0,!0,null)},FadeScreen.prototype.start=function(){this.fadeScreenImage.enabled=!0,this.onlyFadeOut?(this.state=2,this.fadeScreenImage.element.opacity=1,this.action&&this.action()):(this.state=1,this.fadeScreenImage.element.opacity=0)},FadeScreen.prototype.update=function(e){if(this.fading){if(this.delay>0)return this.delay-=e,void(this.delay<=0&&this.start());var t;this.time+=e,(t=this.time/this.fadeTime)>=1?(this.time=0,1==this.state?(this.fadeScreenImage.element.opacity=1,this.state=2,this.action&&this.action()):2==this.state&&(this.fadeScreenImage.element.opacity=0,this.fadeScreenImage.enabled=!1,this.state=0,this.fading=!1)):1==this.state?this.fadeScreenImage.element.opacity=t:2==this.state&&(this.fadeScreenImage.element.opacity=1-t)}},FadeScreen.prototype.show=function(e,t,i,a){this.fadeTime=e,this.delay=t,this.onlyFadeOut=i,this.action=a,this.time=0,this.fading=!0,0===this.delay&&this.start()};var GameAudio=pc.createScript("gameAudio");GameAudio.instance=null,GameAudio.mute=!1,GameAudio.muteMus=!1,GameAudio.gsMute=!1,GameAudio.loopStep=0,GameAudio.appBlurred=!1,GameAudio.prototype.update=function(e){GameAudio.loopStep>0&&(GameAudio.loopStep+=1,js_isMobileOrTablet()?GameAudio.loopStep>=10&&(GameAudio.loopStep=-1,GameAudio.instance.snd2.play("loopSound")):(GameAudio.loopStep=-1,GameAudio.instance.snd2.play("loopSound")));var o=!GAMESNACKS.isAudioEnabled();o!=GameAudio.gsMute&&(GameAudio.gsMute=o,GameAudio.switchMusic(GameAudio.gsMute),GameAudio.switch(GameAudio.gsMute))},GameAudio.prototype.initialize=function(){GameAudio.instance=this,this.snd2=this.entity.children[0].sound,this.snd=this.entity.sound,GameAudio.gsMute=!GAMESNACKS.isAudioEnabled(),GameAudio.mute=GameAudio.gsMute,GameAudio.muteMus=GameAudio.gsMute,GameAudio.switch(GameAudio.mute),GameAudio.switchMusic(GameAudio.muteMus);this.snd2.slot("loopSound");this.app.on("input:mousepress",this.onMousePress)},GameAudio.prototype.onMousePress=function(){0===GameAudio.loopStep&&(GameAudio.loopStep=1)},GameAudio.switchMusic=function(e){GameAudio.muteMus=e;var o=GameAudio.instance.snd2.slot("loopSound");GameAudio.muteMus?o.volume=2e-5:o.volume=.2},GameAudio.switch=function(e){GameAudio.mute=e,GameAudio.instance.snd.enabled=!GameAudio.mute},GameAudio.play=function(e){(GAMESNACKS.isAudioEnabled()&&!0,GameAudio.instance)&&(GameAudio.instance.snd.slot(e).pitch=1,GameAudio.instance.snd.play(e))},GameAudio.playEx=function(e,o){(GAMESNACKS.isAudioEnabled()&&!0,GameAudio.instance)&&(GameAudio.instance.snd.slot(e).pitch=o,GameAudio.instance.snd.play(e))};var Savefile=pc.createScript("savefile");Savefile.resetOnLoad=0,Savefile.nameFile="ColorBurst3DSave",Savefile.autoSave=!1,Savefile.data={},Savefile.defData={},Savefile.addKey=function(e,a){e=Savefile.nameFile+e,Savefile.data[e]=a,Savefile.defData[e]=a},Savefile.reset=function(){for(var e in Savefile.data)Savefile.data[e]=Savefile.defData[e];Savefile.autoSave&&Savefile.save()},Savefile.storeOb=null,Savefile.load=function(){if(Savefile.storeOb=store.get(Savefile.nameFile),Savefile.storeOb||(Savefile.storeOb={}),Savefile.resetOnLoad)Savefile.reset();else for(var e in Savefile.data)e in Savefile.storeOb?Savefile.data[e]=Savefile.storeOb[e]:Savefile.data[e]=Savefile.defData[e]},Savefile.save=function(){if(!Savefile.storeOb)return 1;for(var e in Savefile.data)Savefile.storeOb[e]=Savefile.data[e];store.set(Savefile.nameFile,Savefile.storeOb)},Savefile.get=function(e){if((e=Savefile.nameFile+e)in Savefile.data)return Savefile.data[e];console.log("Savefile.get() - keyname doesn't exist: '"+e+"'")},Savefile.set=function(e,a){(e=Savefile.nameFile+e)in Savefile.data?Savefile.data[e]=a:(Savefile.addKey(e,a),console.log("Savefile.set() - keyname doesn't exist, new keyname added '"+e+"'")),Savefile.autoSave&&Savefile.cookieSave(Savefile.nameFile+e,a)},Savefile.cookieSave=function(e,a){Savefile.setCookie(e,a.toString(),100)},Savefile.cookieLoad=function(e,a){var i=Savefile.getCookie(e);return i?Number(i):a},Savefile.setCookie=function(e,a,i){var t="";if(i){var f=new Date;f.setTime(f.getTime()+24*i*60*60*1e3),t="; expires="+f.toUTCString()}document.cookie=e+"="+(a||"")+t+"; path=/"},Savefile.getCookie=function(e){for(var a=e+"=",i=document.cookie.split(";"),t=0;t<i.length;t++){for(var f=i[t];" "==f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(a))return f.substring(a.length,f.length)}return null},Savefile.eraseCookie=function(e){document.cookie=e+"=; Max-Age=-99999999;"};var Uipopup=pc.createScript("uipopup");Uipopup.attributes.add("fader",{type:"entity"}),Uipopup.attributes.add("name",{type:"string",default:"Popup Name"}),Uipopup.popups=[],Uipopup.STATE_OPENING=1,Uipopup.STATE_OPENED=2,Uipopup.STATE_CLOSING=3,Uipopup.STATE_CLOSED=4,Uipopup.prototype.initialize=function(){Uipopup.popups.push(this),this.entity.enabled=!1,this.state=Uipopup.STATE_CLOSED,this.tw=null},Uipopup.open=function(p,t){for(var i,o=0;o<Uipopup.popups.length;o++)(i=Uipopup.popups[o]).name==p?i.open():t&&i.close()},Uipopup.isShown=function(p){for(var t,i=0;i<Uipopup.popups.length;i++)if((t=Uipopup.popups[i]).name==p)return t.entity.enabled},Uipopup.close=function(p){for(var t,i=0;i<Uipopup.popups.length;i++)(t=Uipopup.popups[i]).name==p&&t.close()},Uipopup.prototype.open=function(){this.state!=Uipopup.STATE_CLOSED&&"Pause"!=this.name||(this.fader&&(this.fader.enabled=!0),this.state=Uipopup.STATE_OPENING,this.entity.setLocalScale(0,0,0),this.entity.enabled=!0,this.tw&&this.tw.stop(),this.tw=this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(1,1,1),1,pc.BackOut).loop(!1).yoyo(!1).on("complete",function(){this.state=Uipopup.STATE_OPENED,this.tw=null}.bind(this)).start())},Uipopup.prototype.close=function(){this.state!=Uipopup.STATE_OPENED&&this.state!=Uipopup.STATE_OPENING||(this.state=Uipopup.STATE_CLOSING,this.tw&&this.tw.stop(),this.tw=this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(0,0,0),1,pc.BackIn).loop(!1).yoyo(!1).on("complete",function(){if(this.tw=null,this.fader){for(var p,t=!1,i=0;i<Uipopup.popups.length;i++)(p=Uipopup.popups[i]).state!=Uipopup.STATE_OPENED&&p.state!=Uipopup.STATE_OPENING||p.fader==this.fader&&(t=!0);t||(this.fader.enabled=!1)}this.state=Uipopup.STATE_CLOSED,this.entity.enabled=!1}.bind(this)).start())},Uipopup.prototype.update=function(p){this.state!=Uipopup.STATE_OPENED&&this.state!=Uipopup.STATE_OPENING||this.fader&&(this.fader.enabled=!0)};var UiPause=pc.createScript("uiPause");UiPause.attributes.add("popup",{type:"entity"}),UiPause.attributes.add("CountText",{type:"entity",title:"Count Text"}),UiPause.attributes.add("CountTimeRate",{type:"number",default:.5,title:"Count Time Rate"}),UiPause.attributes.add("CountTimeScaling",{type:"number",default:.25,title:"Count Time Scaling"}),UiPause.attributes.add("Counts",{type:"number",default:3,title:"Counts"}),UiPause.prototype.initialize=function(){this.onEnable(),this.on("enable",this.onEnable,this),this.ScaleCountText=this.CountText.getLocalScale().x},UiPause.prototype.onEnable=function(){console.log("pause on"),this.CountText.enabled=!1,this.CountingFlag=!1,this.popup.enabled=!0,Game.instance.pause(),this.popup.setLocalScale(0,0,0),this.popup.tween(this.popup.getLocalScale()).to(new pc.Vec3(1,1,1),.65,pc.BackOut).loop(!1).yoyo(!1).start()},UiPause.prototype.OnResumeClicked=function(){this.setCountDown(),this.popup.tween(this.popup.getLocalScale()).to(new pc.Vec3(0,0,0),.4,pc.BackIn).loop(!1).yoyo(!1).start()},UiPause.prototype.close=function(){this.popup.tween(this.popup.getLocalScale()).to(new pc.Vec3(0,0,0),.4,pc.BackIn).loop(!1).yoyo(!1).on("complete",this.OnClose.bind(this)).start()},UiPause.prototype.OnClose=function(){Game.instance.uiPause.enabled=!1,Game.instance.continue()},UiPause.prototype.OnCounted=function(){this.CountText.enabled=!1,Game.instance.uiPause.enabled=!1,Game.instance.continue(),this.app.fire("game:countend"),this.app.fire("game:resume")},UiPause.prototype.setCountDown=function(){this.CountCntr=this.Counts,this.CountTimeCntr=this.CountTimeRate+.25,this.CountText.setLocalScale(this.ScaleCountText/3,this.ScaleCountText/3,this.ScaleCountText/3),this.CountText.enabled=!0,this.CountText.element.text=this.CountCntr+"",this.CountingFlag=!0,this.CountText.tween(this.CountText.getLocalScale()).to(new pc.Vec3(this.ScaleCountText,this.ScaleCountText,this.ScaleCountText),this.CountTimeScaling+.25,pc.BackOut).loop(!1).yoyo(!1).on("complete",this.CountCallBack.bind(this)).start(),this.CountState=2},UiPause.prototype.CountCallBack=function(){switch(this.CountState){case 0:this.CountText.tween(this.CountText.getLocalScale()).to(new pc.Vec3(this.ScaleCountText/3,this.ScaleCountText/3,this.ScaleCountText/3),this.CountTimeScaling,pc.BackIn).loop(!1).yoyo(!1).on("complete",this.CountCallBack.bind(this)).start(),this.CountState=1;break;case 1:this.CountText.tween(this.CountText.getLocalScale()).to(new pc.Vec3(this.ScaleCountText,this.ScaleCountText,this.ScaleCountText),this.CountTimeScaling,pc.BackOut).loop(!1).yoyo(!1).on("complete",this.CountCallBack.bind(this)).start(),this.CountText.element.text=this.CountCntr+"",this.CountState=2}},UiPause.prototype.update=function(t){this.CountingFlag&&(this.CountTimeCntr-=t,this.CountTimeCntr<=0&&(this.CountTimeCntr=this.CountTimeRate,this.CountCntr--,this.CountCntr<=0?(this.CountingFlag=!1,this.CountText.tween(this.CountText.getLocalScale()).to(new pc.Vec3(0,0,0),2*this.CountTimeScaling,pc.BackIn).loop(!1).yoyo(!1).on("complete",this.OnCounted.bind(this)).start()):(this.CountState=0,this.CountText.tween(this.CountText.getLocalScale()).to(new pc.Vec3(this.ScaleCountText/3,this.ScaleCountText/3,this.ScaleCountText/3),this.CountTimeScaling,pc.BackIn).loop(!1).yoyo(!1).on("complete",this.CountCallBack.bind(this)).start())))};var TextIcon=pc.createScript("textIcon");TextIcon.attributes.add("iconSide",{type:"number",default:1,enum:[{left:1},{right:2}]}),TextIcon.attributes.add("icon",{type:"entity"}),TextIcon.attributes.add("spacing",{type:"number",default:20,title:"icon spacing"}),TextIcon.attributes.add("yspacing",{type:"number",default:0,title:"y spacing"}),TextIcon.prototype.initialize=function(){},TextIcon.prototype.update=function(t){var e=0;e=1===this.iconSide?-(this.spacing+.5*this.entity.element.textWidth):this.spacing+.5*this.entity.element.textWidth,this.icon.setLocalPosition(e,this.yspacing,0)};var Scaler=pc.createScript("scaler");Scaler.easings={linear:pc.Linear,backInOut:pc.BackInOut,sineInOut:pc.SineInOut},Scaler.attributes.add("easing",{type:"string",default:"linear",enum:[{linear:1},{backInOut:2},{sineInOut:3}]}),Scaler.attributes.add("targetSize",{type:"number",default:1.5}),Scaler.attributes.add("time",{type:"number",default:1}),Scaler.attributes.add("loop",{type:"boolean",default:!0}),Scaler.attributes.add("yoyo",{type:"boolean",default:!0}),Scaler.prototype.initialize=function(){this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(this.targetSize,this.targetSize,this.targetSize),this.time,pc.SineInOut).loop(this.loop).yoyo(this.yoyo).start()},Scaler.prototype.update=function(t){};var SoundButton=pc.createScript("soundButton");SoundButton.attributes.add("noSound",{type:"entity"}),SoundButton.prototype.initialize=function(){this.app.on("app:soundchanged",this.onSoundChange,this),this.onEnable(),this.on("enable",this.onEnable,this)},SoundButton.prototype.onSoundChange=function(n){this.noSound.enabled=n},SoundButton.prototype.update=function(n){this.noSound.enabled=GameAudio.mute},SoundButton.prototype.onEnable=function(){this.onSoundChange(GameAudio.mute)};var hidden,visibilityChange,Game=pc.createScript("game");function handleVisibilityChange(){(document[hidden]||"visible"!=document.visibilityState)&&trySetOnPause()}function trySetOnPause(){Main.instance.gameState==GAME_PLAYING&&(console.log("window unfocused"),Game.instance.interface.enabled=!1,Game.instance.slomo=0,Uipopup.open("Pause",!0))}Game.instance=null,Game.attributes.add("tutorSlider",{type:"entity"}),Game.attributes.add("shop",{type:"entity"}),Game.attributes.add("mainMenu",{type:"entity"}),Game.attributes.add("interface",{type:"entity"}),Game.attributes.add("gameOver",{type:"entity"}),Game.prototype.initialize=function(){Game.instance=this,void 0!==document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):void 0!==document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),void 0===document.addEventListener||void 0===hidden?console.log("This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API."):document.addEventListener(visibilityChange,handleVisibilityChange,!1),this.controlsSensivity=1.2,this.startGameButtonEnabled=!0,this.slomo=1,this.stars=0,this.chosenSkinId=0,this.firstLaunch=0,ShopController.createSkins(),Savefile.addKey("firstLaunch",1),Savefile.addKey("bestScore",0),Savefile.addKey("chosenSkinId",0),Savefile.addKey("stars",0);for(var e=0;e<ShopController.shopItems.length;e++)Savefile.addKey("skin"+e.toString(),0);Savefile.load(),this.firstLaunch=Savefile.get("firstLaunch"),this.bestScore=Savefile.get("bestScore"),this.chosenSkinId=Savefile.get("chosenSkinId"),this.stars=Savefile.get("stars");for(e=0;e<ShopController.shopItems.length;e++){var t=Savefile.get("skin"+e.toString());t=0!==t,0===e&&(t=!0),ShopController.shopItems[e].unlocked=t}this.currScore=0,this.firstLaunch=1,this.firstLaunch2=1,1==this.firstLaunch2&&setTimeout((function(){Savefile.set("firstLaunch",0),Main.instance.AllowGameInputFlag=!1,Game.instance.startGameButtonEnabled=!1,MyButton.setClickable(Game.instance.mainMenu,!1),Uipopup.open("Tutorial",!0)}),100),js_GS_gameReady()},Game.prototype.wasteStars=function(e){return this.stars>=e?(this.stars-=e,1):0},Game.prototype.update=function(e){Uipopup.isShown("Pause")&&(Game.instance.slomo=0,Main.instance.AllowGameInputFlag=!1),window.scrollTo(0,10),this.setResolution()},Game.prototype.setResolution=function(){var e=window.innerWidth,t=window.innerHeight;e<640&&(this.app.setCanvasResolution(pc.RESOLUTION_AUTO,e,t),this.app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW))},Game.prototype.saveSkins=function(){Savefile.set("stars",this.stars);for(var e=0;e<ShopController.shopItems.length;e++){var t=ShopController.shopItems[e].unlocked;t=t?1:0,Savefile.set("skin"+e.toString(),t)}Savefile.save()},Game.prototype.updateBestScore=function(e){Savefile.set("stars",this.stars),e>this.bestScore&&(this.bestScore=e,Savefile.set("bestScore",e)),Savefile.save()},Game.prototype.onStartGame=function(){this.mainMenu.enabled=!1,this.interface.enabled=!0},Game.prototype.onGameOver=function(e,t){this.currScore=t,this.interface.enabled=!1,FadeScreen.instance.show(.5,2.5,1,(function(){Game.instance.updateBestScore(Game.instance.currScore),Game.instance.gameOver.enabled=!0,GameAudio.play("score")})),GameAudio.play("crush"),GameAudio.play("crush2")},Game.prototype.onGoIntro=function(){this.mainMenu.enabled=!0};var MathUtil=pc.createScript("mathUtil");MathUtil.DEG_TO_RAD=Math.PI/180,MathUtil.RAD_TO_DEG=180/Math.PI,MathUtil.tmpVec3=new pc.Vec3(0,0,0),MathUtil.tmpVec3b=new pc.Vec3(0,0,0),MathUtil.raycastMouseDistance=function(t,a,n,r){var o=t.screenToWorld(Input.mouseX,Input.mouseY,.1),e=t.screenToWorld(Input.mouseX,Input.mouseY,1.1),h=MathUtil.tmpVec3b;h.copy(e),h.sub(o);for(var i=a.getPosition(),u=n/(r-1),c=MathUtil.tmpVec3,M=1e8,l=0,p=0;p<r;p++){if(c.copy(h),c.scale(p*u),c.add(o),l=c.distance(i),!(M<0||l<M))return M;M=l}return M},MathUtil.randomID=function(t){return Math.floor(Math.random()*t)},MathUtil.irr=function(t,a){return Math.floor(Math.random()*(a-t+1)+t)},MathUtil.chance=function(t){return Math.random()<=t},MathUtil.rr=function(t,a){return pc.math.random(t,a)},MathUtil.getRandomInt=function(t){return Math.floor(Math.random()*Math.floor(t))},MathUtil.find2DAngle=function(t,a,n,r){return Math.atan2(r-y1,n-x1)},MathUtil.choose=function(){for(var t=[],a=0;a<arguments.length;a++)t.push(arguments[a]);var n=Math.round(pc.math.random(0,arguments.length-1));return t[n]},MathUtil.prototype.dot=function(t,a){return t.x*a.x+t.y*a.y+t.z*a.z+t.w*a.w},MathUtil.prototype.quatAngle=function(t,a){var n=this.dot(t,a);if(t.equals(a))return 0;var r=1/(Math.PI/180);return 2*Math.acos(Math.min(Math.abs(n),1))*r},MathUtil.prototype.rotateTowards=function(t,a,n){return 0===this.quatAngle(t,a)?a:(new pc.Quat).slerp(t,a,n)};var BestScore=pc.createScript("bestScore");BestScore.prototype.initialize=function(){},BestScore.prototype.update=function(e){this.entity.element.text=Game.instance.bestScore};var Uiinterface=pc.createScript("uiinterface");Uiinterface.attributes.add("score",{type:"entity"}),Uiinterface.prototype.initialize=function(){this.onEnable(),this.on("enable",this.onEnable,this)},Uiinterface.prototype.onEnable=function(){this.score.script.counterText.setValue(0,Game.instance.currScore,Game.instance.currScore)},Uiinterface.prototype.update=function(e){};var CounterText=pc.createScript("counterText");CounterText.attributes.add("targetValue",{type:"number",default:0}),CounterText.attributes.add("shownValue",{type:"number",default:0}),CounterText.attributes.add("changingSpeed",{type:"number",default:10}),CounterText.prototype.initialize=function(){this.currValue=this.shownValue,this.entity.element.text=this.shownValue.toString()},CounterText.prototype.setValue=function(t,e,u){this.currValue=t,this.shownValue=t,this.targetValue=e,this.changingSpeed=u,this.entity.element.text=this.shownValue.toString()},CounterText.prototype.update=function(t){this.shownValue!=this.targetValue&&(this.currValue<this.targetValue?(this.currValue+=this.changingSpeed*t,this.currValue>=this.targetValue&&(this.currValue=this.targetValue),this.shownValue=Math.round(this.currValue)):(this.currValue-=this.changingSpeed*t,this.currValue<=this.targetValue&&(this.currValue=this.targetValue),this.shownValue=Math.round(this.currValue)),this.entity.element.text=this.shownValue.toString())};var Uigameplay=pc.createScript("uigameplay");Uigameplay.attributes.add("score",{type:"entity"}),Uigameplay.prototype.initialize=function(){this.onEnable(),this.on("enable",this.onEnable,this)},Uigameplay.prototype.onEnable=function(){this.score.script.counterText.setValue(0,0,50),this.score.setLocalScale(0,0,0),this.score.tween(this.score.getLocalScale()).to(new pc.Vec3(1,1,1),.8,pc.BackOut).loop(!1).yoyo(!1).start()},Uigameplay.prototype.update=function(e){this.score.script.counterText.targetValue=Main.instance.Score};var ShopController=pc.createScript("shopController");ShopController.shopItems=[],ShopController.shopItemsCount=0,ShopController.createSkins=function(){ShopController.createSkin("1",0,1),ShopController.createSkin("2",200,1),ShopController.createSkin("3",200,1),ShopController.createSkin("4",200,1),ShopController.createSkin("5",200,1),ShopController.createSkin("6",500,0),ShopController.createSkin("7",500,1),ShopController.createSkin("8",500,1),ShopController.createSkin("9",1e3,1),ShopController.createSkin("10",1e3,0)},ShopController.applySkin=function(t,e){},ShopController.createSkin=function(t,e,o){var n={name:t,price:e,enableRotation:o,unlocked:!1};0===n.price&&(n.unlocked=!0),ShopController.shopItems.push(n),ShopController.shopItemsCount++},ShopController.attributes.add("unav",{type:"asset",assetType:"material",title:"locked"}),ShopController.attributes.add("av",{type:"asset",assetType:"material",title:"unlocked"}),ShopController.attributes.add("unlock",{type:"entity"}),ShopController.attributes.add("choose",{type:"entity"}),ShopController.attributes.add("priceText",{type:"entity"}),ShopController.attributes.add("pricePanel",{type:"entity"}),ShopController.attributes.add("modelEntity",{type:"entity"}),ShopController.attributes.add("modelPlayerEntity",{type:"entity"}),ShopController.attributes.add("arrowLeft",{type:"entity"}),ShopController.attributes.add("arrowRight",{type:"entity"}),ShopController.instance=null,ShopController.prototype.initialize=function(){ShopController.instance=this,this.shownItemId=0,ShopController.instance.chooseSkin(Game.instance.chosenSkinId),this.entity.enabled=!1,this.on("enable",this.onEnable,this)},ShopController.prototype.placeDemostrator=function(){},ShopController.prototype.onEnable=function(){this.modelEntity.enabled=!0,this.showItem(Game.instance.chosenSkinId)},ShopController.prototype.showItem=function(t){var e;this.shownItemId=t;for(var o=0;o<this.modelEntity.children.length;o++)o==t?(e=this.modelEntity.children[o]).enabled=!0:this.modelEntity.children[o].enabled=!1;var n=ShopController.shopItems[this.shownItemId];!0===n.unlocked||1===n.unlocked?(this.choose.enabled=!0,this.unlock.enabled=!1,EntityTools.setMaterial(e,this.av)):(EntityTools.setMaterial(e,this.unav),this.priceText.element.text=n.price.toString(),this.choose.enabled=!1,this.unlock.enabled=!0,Game.instance.coins>=n.price?this.unlock.button.active=!0:this.unlock.button.active=!1),this.updateArrows()},ShopController.prototype.itemsAvailable=function(){for(var t=0;t<ShopController.shopItems.length;t++)if(!ShopController.shopItems[t].unlocked&&ShopController.shopItems[t].price<=Game.instance.stars)return!0;return!1},ShopController.prototype.chooseSkin=function(t){var e,o=ShopController.shopItems[t];Game.instance.chosenSkinId=t;for(var n=0;n<this.modelPlayerEntity.children.length;n++)n==t?(e=this.modelPlayerEntity.children[n]).enabled=!0:this.modelPlayerEntity.children[n].enabled=!1;this.modelPlayerEntity.script.ball.ballModel=e,this.modelPlayerEntity.script.ball.enableRotation=o.enableRotation,Ball.isRocket=9==t,Savefile.set("chosenSkinId",Game.instance.chosenSkinId),Savefile.save()},ShopController.prototype.buyItem=function(t){var e=ShopController.shopItems[t];!0===e.unlocked||1===e.unlocked||Game.instance.wasteStars(e.price)&&(FadeScreen.instance.show(.3,0,!0,null),e.unlocked=!0,Game.instance.chosenSkinId=this.shownItemId,this.showItem(t),this.chooseSkin(t),GameAudio.play("buy"),Game.instance.saveSkins(),this.onEnable(),console.log("shop : skin purchased ",e.name))},ShopController.prototype.closeShop=function(){this.modelEntity.enabled=!1},ShopController.prototype.switchItem=function(t){this.shownItemId+=t,this.shownItemId>=ShopController.shopItemsCount-1?this.shownItemId=ShopController.shopItemsCount-1:this.shownItemId<0&&(this.shownItemId=0),this.showItem(this.shownItemId)},ShopController.prototype.update=function(t){this.modelEntity.rotateLocal(0,-120*t,0)},ShopController.prototype.updateArrows=function(t){this.arrowLeft.enabled=!0,this.arrowRight.enabled=!0,this.shownItemId>=ShopController.shopItemsCount-1&&(this.arrowRight.enabled=!1),this.shownItemId<=0&&(this.arrowLeft.enabled=!1)};var EntityTools=pc.createScript("entityTools");EntityTools.reparent=function(t,e){var n=t.getPosition().clone(),o=t.getRotation().clone(),a=t.getScale().clone();t.reparent(e),t.setPosition(n),t.setRotation(o),t.setLocalScale(a)},EntityTools.createParentAtPoint=function(t,e,n){var o=new pc.Entity;return n.addChild(o),o.setPosition(e),EntityTools.reparent(t,o),o},EntityTools.setTexture=function(t,e){for(var n=e.resource,o=t.model.meshInstances,a=0;a<o.length;++a){var r=o[a];r.material.diffuseMap=n,r.material.update()}},EntityTools.setMaterial=function(t,e){for(var n=e.resource,o=t.model.meshInstances,a=0;a<o.length;++a){var r=o[a];r.material=n,r.material.update()}},EntityTools.setLayers=function(t,e){for(var n=[],o=1;o<arguments.length;o++)n.push(Game.instance.app.scene.layers.getLayerByName(arguments[o]).id);t.model.layers=n};var StarsCount=pc.createScript("starsCount");StarsCount.prototype.initialize=function(){},StarsCount.prototype.update=function(t){this.entity.element.text=Game.instance.stars};var ShopButton=pc.createScript("shopButton");ShopButton.attributes.add("new",{type:"entity"}),ShopButton.prototype.initialize=function(){this.time=1.5,this.new.enabled=!1,this.on("enable",this.onEnable,this)},ShopButton.prototype.onEnable=function(){this.new.enabled=ShopController.instance.itemsAvailable()},ShopButton.prototype.update=function(t){this.time+=t,this.time>2&&(this.time=0,this.new.enabled=ShopController.instance.itemsAvailable())};var js_GS_gameIsReady=!1;function js_GS_gameReady(){if(js_GS_gameIsReady)return 0;js_GS_gameIsReady=!0,GAMESNACKS.gameReady(),console.log("GAMESNACKS : game ready!")}function js_GS_levelCompleted(e){GAMESNACKS.levelComplete(e),console.log("GAMESNACKS : level complete "+e.toString())}function js_GS_sendScore(e){GAMESNACKS.sendScore(e),console.log("GAMESNACKS : score sent "+e.toString())}function js_GS_gameOver(){GAMESNACKS.gameOver(),console.log("GAMESNACKS : game over")}var audioEnabled=!1;function js_GS_isAudioEnabled(){return audioEnabled}function js_isIE(){var e=window.navigator.userAgent;return/MSIE|Trident/.test(e)}function js_isMobileOrTablet(){var e,o=!1;e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(o=!0);var a=navigator.maxTouchPoints||"ontouchstart"in document.documentElement,i=void 0!==window.orientation;return o||(a||i)}var Mover=pc.createScript("mover");Mover.attributes.add("delta",{type:"vec3"}),Mover.attributes.add("time",{type:"number",default:1}),Mover.attributes.add("loop",{type:"boolean",default:!0}),Mover.attributes.add("yoyo",{type:"boolean",default:!0}),Mover.prototype.initialize=function(){var t=this.entity.getLocalPosition().clone();t.add(this.delta),this.entity.tween(this.entity.getLocalPosition()).to(t,this.time,pc.SineInOut).loop(this.loop).yoyo(this.yoyo).start()},Mover.prototype.update=function(t){};var UisliderBar=pc.createScript("uisliderBar");UisliderBar.attributes.add("slider",{type:"entity"}),UisliderBar.attributes.add("width",{type:"number",default:200}),UisliderBar.prototype.initialize=function(){this.slider.element.on("mousedown",this.onMouseDown,this),this.slider.element.on("mouseup",this.onMouseLeave,this),this.slider.element.on("touchstart",this.onMouseDown,this),this.slider.element.on("touchend",this.onMouseLeave,this),this.clickable=!0,this.value=.5,this.mouseXStart=0,this.xStart=0},UisliderBar.prototype.onMouseDown=function(t){if(FadeScreen.instance.fading)return 1;if(this.clickable&&!this.mouseDown){this.mouseDown=!0,this.mouseXStart=t.x;var i=this.slider.getLocalPosition();this.xStart=i.x}},UisliderBar.prototype.onMouseLeave=function(){this.mouseDown&&(this.mouseDown=!1)},UisliderBar.prototype.update=function(t){if(Input.mouseDown||(this.mouseDown=!1),this.mouseDown){this.entity.getPosition(),this.slider.getLocalPosition();var i=pc.math.clamp(this.xStart+(Input.mouseX-this.mouseXStart),-this.width/2,+this.width/2);this.value=.5+i/this.width,console.log(this.value),this.slider.setLocalPosition(i,0,0)}Game.instance.controlsSensivity=pc.math.lerp(.2,2,this.value)};var MusicBut=pc.createScript("musicBut");MusicBut.attributes.add("noSound",{type:"entity"}),MusicBut.prototype.initialize=function(){this.onEnable(),this.on("enable",this.onEnable,this)},MusicBut.prototype.onSoundChange=function(t){this.noSound.enabled=t},MusicBut.prototype.update=function(t){this.noSound.enabled=GameAudio.muteMus},MusicBut.prototype.onEnable=function(){this.onSoundChange(GameAudio.muteMus)};// store.legacy.min.js
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.store=e()}}(function(){var define,module,exports;return function e(t,n,r){function o(u,a){if(!n[u]){if(!t[u]){var c="function"==typeof require&&require;if(!a&&c)return c(u,!0);if(i)return i(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var s=n[u]={exports:{}};t[u][0].call(s.exports,function(e){var n=t[u][1][e];return o(n?n:e)},s,s.exports,e,t,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,t,n){"use strict";var r=e("../src/store-engine"),o=e("../storages/all"),i=[e("../plugins/json2")];t.exports=r.createStore(o,i)},{"../plugins/json2":2,"../src/store-engine":4,"../storages/all":6}],2:[function(e,t,n){"use strict";function r(){return e("./lib/json2"),{}}t.exports=r},{"./lib/json2":3}],3:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"object"!==("undefined"==typeof JSON?"undefined":_typeof(JSON))&&(JSON={}),function(){function f(e){return e<10?"0"+e:e}function this_value(){return this.valueOf()}function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,o,i,u,a=gap,c=t[e];switch(c&&"object"===("undefined"==typeof c?"undefined":_typeof(c))&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),"undefined"==typeof c?"undefined":_typeof(c)){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,u=[],"[object Array]"===Object.prototype.toString.apply(c)){for(i=c.length,n=0;n<i;n+=1)u[n]=str(n,c)||"null";return o=0===u.length?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+a+"]":"["+u.join(",")+"]",gap=a,o}if(rep&&"object"===("undefined"==typeof rep?"undefined":_typeof(rep)))for(i=rep.length,n=0;n<i;n+=1)"string"==typeof rep[n]&&(r=rep[n],o=str(r,c),o&&u.push(quote(r)+(gap?": ":":")+o));else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(o=str(r,c),o&&u.push(quote(r)+(gap?": ":":")+o));return o=0===u.length?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+a+"}":"{"+u.join(",")+"}",gap=a,o}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;r<n;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!==("undefined"==typeof t?"undefined":_typeof(t))||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,o=e[t];if(o&&"object"===("undefined"==typeof o?"undefined":_typeof(o)))for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(r=walk(o,n),void 0!==r?o[n]=r:delete o[n]);return reviver.call(e,t,o)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()},{}],4:[function(e,t,n){"use strict";function r(){var e="undefined"==typeof console?null:console;if(e){var t=e.warn?e.warn:e.log;t.apply(e,arguments)}}function o(e,t,n){n||(n=""),e&&!l(e)&&(e=[e]),t&&!l(t)&&(t=[t]);var o=n?"__storejs_"+n+"_":"",i=n?new RegExp("^"+o):null,v=/^[a-zA-Z0-9_\-]*$/;if(!v.test(n))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var h={_namespacePrefix:o,_namespaceRegexp:i,_testStorage:function(e){try{var t="__storejs__test__";e.write(t,t);var n=e.read(t)===t;return e.remove(t),n}catch(r){return!1}},_assignPluginFnProp:function(e,t){var n=this[t];this[t]=function(){function t(){if(n)return c(arguments,function(e,t){r[t]=e}),n.apply(o,r)}var r=u(arguments,0),o=this,i=[t].concat(r);return e.apply(o,i)}},_serialize:function(e){return JSON.stringify(e)},_deserialize:function(e,t){if(!e)return t;var n="";try{n=JSON.parse(e)}catch(r){n=e}return void 0!==n?n:t},_addStorage:function(e){this.enabled||this._testStorage(e)&&(this.storage=e,this.enabled=!0)},_addPlugin:function(e){var t=this;if(l(e))return void c(e,function(e){t._addPlugin(e)});var n=a(this.plugins,function(t){return e===t});if(!n){if(this.plugins.push(e),!p(e))throw new Error("Plugins must be function values that return objects");var r=e.call(this);if(!d(r))throw new Error("Plugins must return an object of function properties");c(r,function(n,r){if(!p(n))throw new Error("Bad plugin property: "+r+" from plugin "+e.name+". Plugins should only return functions.");t._assignPluginFnProp(n,r)})}},addStorage:function(e){r("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(e)}},m=s(h,g,{plugins:[]});return m.raw={},c(m,function(e,t){p(e)&&(m.raw[t]=f(m,e))}),c(e,function(e){m._addStorage(e)}),c(t,function(e){m._addPlugin(e)}),m}var i=e("./util"),u=i.slice,a=i.pluck,c=i.each,f=i.bind,s=i.create,l=i.isList,p=i.isFunction,d=i.isObject;t.exports={createStore:o};var g={version:"2.0.12",enabled:!1,get:function(e,t){var n=this.storage.read(this._namespacePrefix+e);return this._deserialize(n,t)},set:function(e,t){return void 0===t?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each(function(n,r){e.call(t,t._deserialize(n),(r||"").replace(t._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return o.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return o(this.storage,this.plugins,e)}}},{"./util":5}],5:[function(e,t,n){(function(e){"use strict";function n(){return Object.assign?Object.assign:function(e,t,n,r){for(var o=1;o<arguments.length;o++)a(Object(arguments[o]),function(t,n){e[n]=t});return e}}function r(){if(Object.create)return function(e,t,n,r){var o=u(arguments,1);return d.apply(this,[Object.create(e)].concat(o))};var e=function(){};return function(t,n,r,o){var i=u(arguments,1);return e.prototype=t,d.apply(this,[new e].concat(i))}}function o(){return String.prototype.trim?function(e){return String.prototype.trim.call(e)}:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function i(e,t){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}}function u(e,t){return Array.prototype.slice.call(e,t||0)}function a(e,t){f(e,function(e,n){return t(e,n),!1})}function c(e,t){var n=s(e)?[]:{};return f(e,function(e,r){return n[r]=t(e,r),!1}),n}function f(e,t){if(s(e)){for(var n=0;n<e.length;n++)if(t(e[n],n))return e[n]}else for(var r in e)if(e.hasOwnProperty(r)&&t(e[r],r))return e[r]}function s(e){return null!=e&&"function"!=typeof e&&"number"==typeof e.length}function l(e){return e&&"[object Function]"==={}.toString.call(e)}function p(e){return e&&"[object Object]"==={}.toString.call(e)}var d=n(),g=r(),v=o(),h="undefined"!=typeof window?window:e;t.exports={assign:d,create:g,trim:v,bind:i,slice:u,each:a,map:c,pluck:f,isList:s,isFunction:l,isObject:p,Global:h}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,n){"use strict";t.exports=[e("./localStorage"),e("./oldFF-globalStorage"),e("./oldIE-userDataStorage"),e("./cookieStorage"),e("./sessionStorage"),e("./memoryStorage")]},{"./cookieStorage":7,"./localStorage":8,"./memoryStorage":9,"./oldFF-globalStorage":10,"./oldIE-userDataStorage":11,"./sessionStorage":12}],7:[function(e,t,n){"use strict";function r(e){if(!e||!c(e))return null;var t="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(p.cookie.replace(new RegExp(t),"$1"))}function o(e){for(var t=p.cookie.split(/; ?/g),n=t.length-1;n>=0;n--)if(l(t[n])){var r=t[n].split("="),o=unescape(r[0]),i=unescape(r[1]);e(i,o)}}function i(e,t){e&&(p.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function u(e){e&&c(e)&&(p.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function a(){o(function(e,t){u(t)})}function c(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(p.cookie)}var f=e("../src/util"),s=f.Global,l=f.trim;t.exports={name:"cookieStorage",read:r,write:i,each:o,remove:u,clearAll:a};var p=s.document},{"../src/util":5}],8:[function(e,t,n){"use strict";function r(){return s.localStorage}function o(e){return r().getItem(e)}function i(e,t){return r().setItem(e,t)}function u(e){for(var t=r().length-1;t>=0;t--){var n=r().key(t);e(o(n),n)}}function a(e){return r().removeItem(e)}function c(){return r().clear()}var f=e("../src/util"),s=f.Global;t.exports={name:"localStorage",read:o,write:i,each:u,remove:a,clearAll:c}},{"../src/util":5}],9:[function(e,t,n){"use strict";function r(e){return c[e]}function o(e,t){c[e]=t}function i(e){for(var t in c)c.hasOwnProperty(t)&&e(c[t],t)}function u(e){delete c[e]}function a(e){c={}}t.exports={name:"memoryStorage",read:r,write:o,each:i,remove:u,clearAll:a};var c={}},{}],10:[function(e,t,n){"use strict";function r(e){return s[e]}function o(e,t){s[e]=t}function i(e){for(var t=s.length-1;t>=0;t--){var n=s.key(t);e(s[n],n)}}function u(e){return s.removeItem(e)}function a(){i(function(e,t){delete s[e]})}var c=e("../src/util"),f=c.Global;t.exports={name:"oldFF-globalStorage",read:r,write:o,each:i,remove:u,clearAll:a};var s=f.globalStorage},{"../src/util":5}],11:[function(e,t,n){"use strict";function r(e,t){if(!v){var n=c(e);g(function(e){e.setAttribute(n,t),e.save(p)})}}function o(e){if(!v){var t=c(e),n=null;return g(function(e){n=e.getAttribute(t)}),n}}function i(e){g(function(t){for(var n=t.XMLDocument.documentElement.attributes,r=n.length-1;r>=0;r--){var o=n[r];e(t.getAttribute(o.name),o.name)}})}function u(e){var t=c(e);g(function(e){e.removeAttribute(t),e.save(p)})}function a(){g(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(p);for(var n=t.length-1;n>=0;n--)e.removeAttribute(t[n].name);e.save(p)})}function c(e){return e.replace(/^\d/,"___$&").replace(h,"___")}function f(){if(!d||!d.documentElement||!d.documentElement.addBehavior)return null;var e,t,n,r="script";try{t=new ActiveXObject("htmlfile"),t.open(),t.write("<"+r+">document.w=window</"+r+'><iframe src="/favicon.ico"></iframe>'),t.close(),e=t.w.frames[0].document,n=e.createElement("div")}catch(o){n=d.createElement("div"),e=d.body}return function(t){var r=[].slice.call(arguments,0);r.unshift(n),e.appendChild(n),n.addBehavior("#default#userData"),n.load(p),t.apply(this,r),e.removeChild(n)}}var s=e("../src/util"),l=s.Global;t.exports={name:"oldIE-userDataStorage",write:r,read:o,each:i,remove:u,clearAll:a};var p="storejs",d=l.document,g=f(),v=(l.navigator?l.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./),h=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g")},{"../src/util":5}],12:[function(e,t,n){"use strict";function r(){return s.sessionStorage}function o(e){return r().getItem(e)}function i(e,t){return r().setItem(e,t)}function u(e){for(var t=r().length-1;t>=0;t--){var n=r().key(t);e(o(n),n)}}function a(e){return r().removeItem(e)}function c(){return r().clear()}var f=e("../src/util"),s=f.Global;t.exports={name:"sessionStorage",read:o,write:i,each:u,remove:a,clearAll:c}},{"../src/util":5}]},{},[1])(1)});


